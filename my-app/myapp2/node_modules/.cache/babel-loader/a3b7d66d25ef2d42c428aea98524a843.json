{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nvar _react = require(\"react\");\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _propTypes = require(\"prop-types\");\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _d3Selection = require(\"d3-selection\");\n\nvar _d3Array = require(\"d3-array\");\n\nvar _utils = require(\"../utils\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n}\n\nvar AxisZoomCapture = function (_Component) {\n  _inherits(AxisZoomCapture, _Component);\n\n  function AxisZoomCapture(props) {\n    _classCallCheck(this, AxisZoomCapture);\n\n    var _this = _possibleConstructorReturn(this, (AxisZoomCapture.__proto__ || Object.getPrototypeOf(AxisZoomCapture)).call(this, props));\n\n    _this.handleDragStartMouse = _this.handleDragStartMouse.bind(_this);\n    _this.handleDragStartTouch = _this.handleDragStartTouch.bind(_this);\n    _this.handleDrag = _this.handleDrag.bind(_this);\n    _this.handleDragEnd = _this.handleDragEnd.bind(_this);\n    _this.handleRightClick = _this.handleRightClick.bind(_this);\n    _this.saveNode = _this.saveNode.bind(_this);\n    _this.state = {\n      startPosition: null\n    };\n    return _this;\n  }\n\n  _createClass(AxisZoomCapture, [{\n    key: \"saveNode\",\n    value: function saveNode(node) {\n      this.node = node;\n    }\n  }, {\n    key: \"handleRightClick\",\n    value: function handleRightClick(e) {\n      e.stopPropagation();\n      e.preventDefault();\n      var onContextMenu = this.props.onContextMenu;\n      var mouseXY = (0, _utils.mousePosition)(e, this.node.getBoundingClientRect());\n      (0, _d3Selection.select)((0, _utils.d3Window)(this.node)).on(_utils.MOUSEMOVE, null).on(_utils.MOUSEUP, null);\n      this.setState({\n        startPosition: null\n      });\n      onContextMenu(mouseXY, e);\n      this.contextMenuClicked = true;\n    }\n  }, {\n    key: \"handleDragStartMouse\",\n    value: function handleDragStartMouse(e) {\n      this.mouseInteraction = true;\n      var _props = this.props,\n          getScale = _props.getScale,\n          getMoreProps = _props.getMoreProps;\n      var startScale = getScale(getMoreProps());\n      this.dragHappened = false;\n\n      if (startScale.invert) {\n        (0, _d3Selection.select)((0, _utils.d3Window)(this.node)).on(_utils.MOUSEMOVE, this.handleDrag, false).on(_utils.MOUSEUP, this.handleDragEnd, false);\n        var startXY = (0, _utils.mousePosition)(e);\n        this.setState({\n          startPosition: {\n            startXY: startXY,\n            startScale: startScale\n          }\n        });\n      }\n\n      e.preventDefault();\n    }\n  }, {\n    key: \"handleDragStartTouch\",\n    value: function handleDragStartTouch(e) {\n      this.mouseInteraction = false;\n      var _props2 = this.props,\n          getScale = _props2.getScale,\n          getMoreProps = _props2.getMoreProps;\n      var startScale = getScale(getMoreProps());\n      this.dragHappened = false;\n\n      if (e.touches.length === 1 && startScale.invert) {\n        (0, _d3Selection.select)((0, _utils.d3Window)(this.node)).on(_utils.TOUCHMOVE, this.handleDrag).on(_utils.TOUCHEND, this.handleDragEnd);\n        var startXY = (0, _utils.touchPosition)((0, _utils.getTouchProps)(e.touches[0]), e);\n        this.setState({\n          startPosition: {\n            startXY: startXY,\n            startScale: startScale\n          }\n        });\n      }\n    }\n  }, {\n    key: \"handleDrag\",\n    value: function handleDrag() {\n      var startPosition = this.state.startPosition;\n      var _props3 = this.props,\n          getMouseDelta = _props3.getMouseDelta,\n          inverted = _props3.inverted;\n      this.dragHappened = true;\n\n      if ((0, _utils.isDefined)(startPosition)) {\n        var startScale = startPosition.startScale;\n        var startXY = startPosition.startXY;\n        var mouseXY = this.mouseInteraction ? (0, _d3Selection.mouse)(this.node) : (0, _d3Selection.touches)(this.node)[0];\n        var diff = getMouseDelta(startXY, mouseXY);\n        var center = (0, _d3Array.mean)(startScale.range());\n        var tempRange = startScale.range().map(function (d) {\n          return inverted ? d - (0, _utils.sign)(d - center) * diff : d + (0, _utils.sign)(d - center) * diff;\n        });\n        var newDomain = tempRange.map(startScale.invert);\n\n        if ((0, _utils.sign)((0, _utils.last)(startScale.range()) - (0, _utils.first)(startScale.range())) === (0, _utils.sign)((0, _utils.last)(tempRange) - (0, _utils.first)(tempRange))) {\n          var axisZoomCallback = this.props.axisZoomCallback; // console.log(startXScale.domain(), newXDomain)\n\n          axisZoomCallback(newDomain);\n        }\n      }\n    }\n  }, {\n    key: \"handleDragEnd\",\n    value: function handleDragEnd() {\n      var _this2 = this;\n\n      if (!this.dragHappened) {\n        if (this.clicked) {\n          var e = _d3Selection.event;\n          var mouseXY = this.mouseInteraction ? (0, _d3Selection.mouse)(this.node) : (0, _d3Selection.touches)(this.node)[0];\n          var onDoubleClick = this.props.onDoubleClick;\n          onDoubleClick(mouseXY, e);\n        } else {\n          this.clicked = true;\n          setTimeout(function () {\n            _this2.clicked = false;\n          }, 300);\n        }\n      }\n\n      (0, _d3Selection.select)((0, _utils.d3Window)(this.node)).on(_utils.MOUSEMOVE, null).on(_utils.MOUSEUP, null).on(_utils.TOUCHMOVE, null).on(_utils.TOUCHEND, null);\n      this.setState({\n        startPosition: null\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _props4 = this.props,\n          bg = _props4.bg,\n          className = _props4.className,\n          zoomCursorClassName = _props4.zoomCursorClassName;\n      var cursor = (0, _utils.isDefined)(this.state.startPosition) ? zoomCursorClassName : \"react-stockcharts-default-cursor\";\n      return _react2.default.createElement(\"rect\", {\n        className: \"react-stockcharts-enable-interaction \" + cursor + \" \" + className,\n        ref: this.saveNode,\n        x: bg.x,\n        y: bg.y,\n        opacity: 0,\n        height: bg.h,\n        width: bg.w,\n        onContextMenu: this.handleRightClick,\n        onMouseDown: this.handleDragStartMouse,\n        onTouchStart: this.handleDragStartTouch\n      });\n    }\n  }]);\n\n  return AxisZoomCapture;\n}(_react.Component);\n\nAxisZoomCapture.propTypes = {\n  innerTickSize: _propTypes2.default.number,\n  outerTickSize: _propTypes2.default.number,\n  tickFormat: _propTypes2.default.func,\n  tickPadding: _propTypes2.default.number,\n  tickSize: _propTypes2.default.number,\n  ticks: _propTypes2.default.number,\n  tickValues: _propTypes2.default.array,\n  showDomain: _propTypes2.default.bool,\n  showTicks: _propTypes2.default.bool,\n  className: _propTypes2.default.string,\n  axisZoomCallback: _propTypes2.default.func,\n  inverted: _propTypes2.default.bool,\n  bg: _propTypes2.default.object.isRequired,\n  zoomCursorClassName: _propTypes2.default.string.isRequired,\n  getMoreProps: _propTypes2.default.func.isRequired,\n  getScale: _propTypes2.default.func.isRequired,\n  getMouseDelta: _propTypes2.default.func.isRequired,\n  onDoubleClick: _propTypes2.default.func.isRequired,\n  onContextMenu: _propTypes2.default.func.isRequired\n};\nAxisZoomCapture.defaultProps = {\n  onDoubleClick: _utils.noop,\n  onContextMenu: _utils.noop,\n  inverted: true\n};\nexports.default = AxisZoomCapture;","map":{"version":3,"sources":["../../../src/lib/axes/AxisZoomCapture.js"],"names":["AxisZoomCapture","startPosition","node","e","onContextMenu","mouseXY","getScale","getMoreProps","startScale","startXY","getMouseDelta","inverted","diff","center","tempRange","d","newDomain","axisZoomCallback","onDoubleClick","setTimeout","bg","className","zoomCursorClassName","cursor","handleDragStartTouch","innerTickSize","outerTickSize","tickFormat","tickPadding","tickSize","ticks","tickValues","showDomain","showTicks","isRequired"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAA,MAAA,GAAA,OAAA,CAAA,OAAA,CAAA;;;;AACA,IAAA,UAAA,GAAA,OAAA,CAAA,YAAA,CAAA;;;;AACA,IAAA,YAAA,GAAA,OAAA,CAAA,cAAA,CAAA;;AACA,IAAA,QAAA,GAAA,OAAA,CAAA,UAAA,CAAA;;AAEA,IAAA,MAAA,GAAA,OAAA,CAAA,UAAA,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAgBMA,e;;;AACL,WAAA,eAAA,CAAA,KAAA,EAAmB;AAAA,IAAA,eAAA,CAAA,IAAA,EAAA,eAAA,CAAA;;AAAA,QAAA,KAAA,GAAA,0BAAA,CAAA,IAAA,EAAA,CAAA,eAAA,CAAA,SAAA,IAAA,MAAA,CAAA,cAAA,CAAA,eAAA,CAAA,EAAA,IAAA,CAAA,IAAA,EAAA,KAAA,CAAA,CAAA;;AAElB,IAAA,KAAA,CAAA,oBAAA,GAA4B,KAAA,CAAA,oBAAA,CAAA,IAAA,CAA5B,KAA4B,CAA5B;AACA,IAAA,KAAA,CAAA,oBAAA,GAA4B,KAAA,CAAA,oBAAA,CAAA,IAAA,CAA5B,KAA4B,CAA5B;AACA,IAAA,KAAA,CAAA,UAAA,GAAkB,KAAA,CAAA,UAAA,CAAA,IAAA,CAAlB,KAAkB,CAAlB;AACA,IAAA,KAAA,CAAA,aAAA,GAAqB,KAAA,CAAA,aAAA,CAAA,IAAA,CAArB,KAAqB,CAArB;AACA,IAAA,KAAA,CAAA,gBAAA,GAAwB,KAAA,CAAA,gBAAA,CAAA,IAAA,CAAxB,KAAwB,CAAxB;AACA,IAAA,KAAA,CAAA,QAAA,GAAgB,KAAA,CAAA,QAAA,CAAA,IAAA,CAAhB,KAAgB,CAAhB;AACA,IAAA,KAAA,CAAA,KAAA,GAAa;AACZC,MAAAA,aAAAA,EAAe;AADH,KAAb;AARkB,WAAA,KAAA;AAWlB;;;;6BACQC,I,EAAM;AACd,WAAA,IAAA,GAAA,IAAA;AACA;;;qCACgBC,C,EAAG;AACnBA,MAAAA,CAAAA,CAAAA,eAAAA;AACAA,MAAAA,CAAAA,CAAAA,cAAAA;AAFmB,UAIXC,aAJW,GAIO,KAJP,KAIO,CAJP,aAAA;AAMnB,UAAMC,OAAAA,GAAU,CAAA,GAAA,MAAA,CAAA,aAAA,EAAA,CAAA,EAAiB,KAAA,IAAA,CAAjC,qBAAiC,EAAjB,CAAhB;AAEA,OAAA,GAAA,YAAA,CAAA,MAAA,EAAO,CAAA,GAAA,MAAA,CAAA,QAAA,EAAS,KAAhB,IAAO,CAAP,EAAA,EAAA,CAAA,MAAA,CAAA,SAAA,EAAA,IAAA,EAAA,EAAA,CAAA,MAAA,CAAA,OAAA,EAAA,IAAA;AAGA,WAAA,QAAA,CAAc;AACbJ,QAAAA,aAAAA,EAAe;AADF,OAAd;AAIAG,MAAAA,aAAAA,CAAAA,OAAAA,EAAAA,CAAAA,CAAAA;AAEA,WAAA,kBAAA,GAAA,IAAA;AACA;;;yCACoBD,C,EAAG;AACvB,WAAA,gBAAA,GAAA,IAAA;AADuB,UAAA,MAAA,GAGY,KAHZ,KAAA;AAAA,UAGfG,QAHe,GAAA,MAAA,CAAA,QAAA;AAAA,UAGLC,YAHK,GAAA,MAAA,CAAA,YAAA;AAIvB,UAAMC,UAAAA,GAAaF,QAAAA,CAASC,YAA5B,EAAmBD,CAAnB;AACA,WAAA,YAAA,GAAA,KAAA;;AAEA,UAAIE,UAAAA,CAAJ,MAAA,EAAuB;AACtB,SAAA,GAAA,YAAA,CAAA,MAAA,EAAO,CAAA,GAAA,MAAA,CAAA,QAAA,EAAS,KAAhB,IAAO,CAAP,EAAA,EAAA,CAAA,MAAA,CAAA,SAAA,EACgB,KADhB,UAAA,EAAA,KAAA,EAAA,EAAA,CAAA,MAAA,CAAA,OAAA,EAEc,KAFd,aAAA,EAAA,KAAA;AAIA,YAAMC,OAAAA,GAAU,CAAA,GAAA,MAAA,CAAA,aAAA,EAAhB,CAAgB,CAAhB;AAEA,aAAA,QAAA,CAAc;AACbR,UAAAA,aAAAA,EAAe;AACdQ,YAAAA,OAAAA,EADc,OAAA;AAEdD,YAAAA,UAAAA,EAAAA;AAFc;AADF,SAAd;AAMA;;AACDL,MAAAA,CAAAA,CAAAA,cAAAA;AACA;;;yCACoBA,C,EAAG;AACvB,WAAA,gBAAA,GAAA,KAAA;AADuB,UAAA,OAAA,GAGY,KAHZ,KAAA;AAAA,UAGfG,QAHe,GAAA,OAAA,CAAA,QAAA;AAAA,UAGLC,YAHK,GAAA,OAAA,CAAA,YAAA;AAIvB,UAAMC,UAAAA,GAAaF,QAAAA,CAASC,YAA5B,EAAmBD,CAAnB;AACA,WAAA,YAAA,GAAA,KAAA;;AAEA,UAAIH,CAAAA,CAAAA,OAAAA,CAAAA,MAAAA,KAAAA,CAAAA,IAA0BK,UAAAA,CAA9B,MAAA,EAAiD;AAChD,SAAA,GAAA,YAAA,CAAA,MAAA,EAAO,CAAA,GAAA,MAAA,CAAA,QAAA,EAAS,KAAhB,IAAO,CAAP,EAAA,EAAA,CAAA,MAAA,CAAA,SAAA,EACgB,KADhB,UAAA,EAAA,EAAA,CAAA,MAAA,CAAA,QAAA,EAEe,KAFf,aAAA;AAIA,YAAMC,OAAAA,GAAU,CAAA,GAAA,MAAA,CAAA,aAAA,EAAc,CAAA,GAAA,MAAA,CAAA,aAAA,EAAcN,CAAAA,CAAAA,OAAAA,CAA5B,CAA4BA,CAAd,CAAd,EAAhB,CAAgB,CAAhB;AAEA,aAAA,QAAA,CAAc;AACbF,UAAAA,aAAAA,EAAe;AACdQ,YAAAA,OAAAA,EADc,OAAA;AAEdD,YAAAA,UAAAA,EAAAA;AAFc;AADF,SAAd;AAMA;AACD;;;iCACY;AAAA,UACJP,aADI,GACc,KADd,KACc,CADd,aAAA;AAAA,UAAA,OAAA,GAEwB,KAFxB,KAAA;AAAA,UAEJS,aAFI,GAAA,OAAA,CAAA,aAAA;AAAA,UAEWC,QAFX,GAAA,OAAA,CAAA,QAAA;AAIZ,WAAA,YAAA,GAAA,IAAA;;AACA,UAAI,CAAA,GAAA,MAAA,CAAA,SAAA,EAAJ,aAAI,CAAJ,EAA8B;AAAA,YACrBH,UADqB,GACNP,aADM,CAAA,UAAA;AAAA,YAErBQ,OAFqB,GAETR,aAFS,CAAA,OAAA;AAI7B,YAAMI,OAAAA,GAAU,KAAA,gBAAA,GACb,CAAA,GAAA,YAAA,CAAA,KAAA,EAAM,KADO,IACb,CADa,GAEb,CAAA,GAAA,YAAA,CAAA,OAAA,EAAQ,KAAR,IAAA,EAFH,CAEG,CAFH;AAIA,YAAMO,IAAAA,GAAOF,aAAAA,CAAAA,OAAAA,EAAb,OAAaA,CAAb;AAEA,YAAMG,MAAAA,GAAS,CAAA,GAAA,QAAA,CAAA,IAAA,EAAKL,UAAAA,CAApB,KAAoBA,EAAL,CAAf;AAEA,YAAMM,SAAAA,GAAY,UAAA,CAAA,KAAA,GAAA,GAAA,CACZ,UAAA,CAAA,EAAA;AAAA,iBAAKH,QAAAA,GAAWI,CAAAA,GAAI,CAAA,GAAA,MAAA,CAAA,IAAA,EAAKA,CAAAA,GAAL,MAAA,IAAfJ,IAAAA,GAAyCI,CAAAA,GAAI,CAAA,GAAA,MAAA,CAAA,IAAA,EAAKA,CAAAA,GAAL,MAAA,IAAlD,IAAA;AADN,SAAkB,CAAlB;AAGA,YAAMC,SAAAA,GAAYF,SAAAA,CAAAA,GAAAA,CAAcN,UAAAA,CAAhC,MAAkBM,CAAlB;;AAEA,YAAI,CAAA,GAAA,MAAA,CAAA,IAAA,EAAK,CAAA,GAAA,MAAA,CAAA,IAAA,EAAKN,UAAAA,CAAL,KAAKA,EAAL,IAA2B,CAAA,GAAA,MAAA,CAAA,KAAA,EAAMA,UAAAA,CAAtC,KAAsCA,EAAN,CAAhC,MAA+D,CAAA,GAAA,MAAA,CAAA,IAAA,EAAK,CAAA,GAAA,MAAA,CAAA,IAAA,EAAA,SAAA,IAAkB,CAAA,GAAA,MAAA,CAAA,KAAA,EAA1F,SAA0F,CAAvB,CAAnE,EAA6G;AAAA,cAEpGS,gBAFoG,GAE/E,KAF+E,KAE/E,CAF+E,gBAAA,CAAA,CAG5G;;AACAA,UAAAA,gBAAAA,CAAAA,SAAAA,CAAAA;AACA;AACD;AACD;;;oCACe;AAAA,UAAA,MAAA,GAAA,IAAA;;AAEf,UAAI,CAAC,KAAL,YAAA,EAAwB;AACvB,YAAI,KAAJ,OAAA,EAAkB;AACjB,cAAMd,CAAAA,GAAAA,YAAAA,CAAN,KAAA;AACA,cAAME,OAAAA,GAAU,KAAA,gBAAA,GACb,CAAA,GAAA,YAAA,CAAA,KAAA,EAAM,KADO,IACb,CADa,GAEb,CAAA,GAAA,YAAA,CAAA,OAAA,EAAQ,KAAR,IAAA,EAFH,CAEG,CAFH;AAFiB,cAKTa,aALS,GAKS,KALT,KAKS,CALT,aAAA;AAOjBA,UAAAA,aAAAA,CAAAA,OAAAA,EAAAA,CAAAA,CAAAA;AAPD,SAAA,MAQO;AACN,eAAA,OAAA,GAAA,IAAA;AACAC,UAAAA,UAAAA,CAAW,YAAM;AAChB,YAAA,MAAA,CAAA,OAAA,GAAA,KAAA;AADDA,WAAAA,EAAAA,GAAAA,CAAAA;AAGA;AACD;;AAED,OAAA,GAAA,YAAA,CAAA,MAAA,EAAO,CAAA,GAAA,MAAA,CAAA,QAAA,EAAS,KAAhB,IAAO,CAAP,EAAA,EAAA,CAAA,MAAA,CAAA,SAAA,EAAA,IAAA,EAAA,EAAA,CAAA,MAAA,CAAA,OAAA,EAAA,IAAA,EAAA,EAAA,CAAA,MAAA,CAAA,SAAA,EAAA,IAAA,EAAA,EAAA,CAAA,MAAA,CAAA,QAAA,EAAA,IAAA;AAMA,WAAA,QAAA,CAAc;AACblB,QAAAA,aAAAA,EAAe;AADF,OAAd;AAGA;;;6BACQ;AAAA,UAAA,OAAA,GACuC,KADvC,KAAA;AAAA,UACAmB,EADA,GAAA,OAAA,CAAA,EAAA;AAAA,UACIC,SADJ,GAAA,OAAA,CAAA,SAAA;AAAA,UACeC,mBADf,GAAA,OAAA,CAAA,mBAAA;AAGR,UAAMC,MAAAA,GAAS,CAAA,GAAA,MAAA,CAAA,SAAA,EAAU,KAAA,KAAA,CAAV,aAAA,IAAA,mBAAA,GAAf,kCAAA;AAIA,aAAO,OAAA,CAAA,OAAA,CAAA,aAAA,CAAA,MAAA,EAAA;AACN,QAAA,SAAA,EAAA,0CAAA,MAAA,GAAA,GAAA,GADM,SAAA;AAEN,QAAA,GAAA,EAAK,KAFC,QAAA;AAGN,QAAA,CAAA,EAAGH,EAAAA,CAHG,CAAA;AAGG,QAAA,CAAA,EAAGA,EAAAA,CAHN,CAAA;AAGY,QAAA,OAAA,EAHZ,CAAA;AAGwB,QAAA,MAAA,EAAQA,EAAAA,CAHhC,CAAA;AAGsC,QAAA,KAAA,EAAOA,EAAAA,CAH7C,CAAA;AAIN,QAAA,aAAA,EAAe,KAJT,gBAAA;AAKN,QAAA,WAAA,EAAa,KALP,oBAAA;AAMN,QAAA,YAAA,EAAc,KAAKI;AANb,OAAA,CAAP;AAQA;;;;;;AAGFxB,eAAAA,CAAAA,SAAAA,GAA4B;AAC3ByB,EAAAA,aAAAA,EAAe,WAAA,CAAA,OAAA,CADY,MAAA;AAE3BC,EAAAA,aAAAA,EAAe,WAAA,CAAA,OAAA,CAFY,MAAA;AAG3BC,EAAAA,UAAAA,EAAY,WAAA,CAAA,OAAA,CAHe,IAAA;AAI3BC,EAAAA,WAAAA,EAAa,WAAA,CAAA,OAAA,CAJc,MAAA;AAK3BC,EAAAA,QAAAA,EAAU,WAAA,CAAA,OAAA,CALiB,MAAA;AAM3BC,EAAAA,KAAAA,EAAO,WAAA,CAAA,OAAA,CANoB,MAAA;AAO3BC,EAAAA,UAAAA,EAAY,WAAA,CAAA,OAAA,CAPe,KAAA;AAQ3BC,EAAAA,UAAAA,EAAY,WAAA,CAAA,OAAA,CARe,IAAA;AAS3BC,EAAAA,SAAAA,EAAW,WAAA,CAAA,OAAA,CATgB,IAAA;AAU3BZ,EAAAA,SAAAA,EAAW,WAAA,CAAA,OAAA,CAVgB,MAAA;AAW3BJ,EAAAA,gBAAAA,EAAkB,WAAA,CAAA,OAAA,CAXS,IAAA;AAY3BN,EAAAA,QAAAA,EAAU,WAAA,CAAA,OAAA,CAZiB,IAAA;AAa3BS,EAAAA,EAAAA,EAAI,WAAA,CAAA,OAAA,CAAA,MAAA,CAbuB,UAAA;AAc3BE,EAAAA,mBAAAA,EAAqB,WAAA,CAAA,OAAA,CAAA,MAAA,CAdM,UAAA;AAe3Bf,EAAAA,YAAAA,EAAc,WAAA,CAAA,OAAA,CAAA,IAAA,CAfa,UAAA;AAgB3BD,EAAAA,QAAAA,EAAU,WAAA,CAAA,OAAA,CAAA,IAAA,CAhBiB,UAAA;AAiB3BI,EAAAA,aAAAA,EAAe,WAAA,CAAA,OAAA,CAAA,IAAA,CAjBY,UAAA;AAkB3BQ,EAAAA,aAAAA,EAAe,WAAA,CAAA,OAAA,CAAA,IAAA,CAlBY,UAAA;AAmB3Bd,EAAAA,aAAAA,EAAe,WAAA,CAAA,OAAA,CAAA,IAAA,CAAe8B;AAnBH,CAA5BlC;AAsBAA,eAAAA,CAAAA,YAAAA,GAA+B;AAC9BkB,EAAAA,aAAAA,EAAAA,MAAAA,CAD8B,IAAA;AAE9Bd,EAAAA,aAAAA,EAAAA,MAAAA,CAF8B,IAAA;AAG9BO,EAAAA,QAAAA,EAAU;AAHoB,CAA/BX;kBAMeA,e","sourcesContent":["\n\nimport React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { select, event as d3Event, mouse, touches } from \"d3-selection\";\nimport { mean } from \"d3-array\";\n\nimport {\n\tfirst,\n\tlast,\n\tisDefined,\n\tnoop,\n\tmousePosition,\n\td3Window,\n\tMOUSEMOVE,\n\tMOUSEUP,\n\tTOUCHMOVE,\n\tTOUCHEND,\n\ttouchPosition,\n\tgetTouchProps,\n\tsign,\n} from \"../utils\";\n\nclass AxisZoomCapture extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.handleDragStartMouse = this.handleDragStartMouse.bind(this);\n\t\tthis.handleDragStartTouch = this.handleDragStartTouch.bind(this);\n\t\tthis.handleDrag = this.handleDrag.bind(this);\n\t\tthis.handleDragEnd = this.handleDragEnd.bind(this);\n\t\tthis.handleRightClick = this.handleRightClick.bind(this);\n\t\tthis.saveNode = this.saveNode.bind(this);\n\t\tthis.state = {\n\t\t\tstartPosition: null\n\t\t};\n\t}\n\tsaveNode(node) {\n\t\tthis.node = node;\n\t}\n\thandleRightClick(e) {\n\t\te.stopPropagation();\n\t\te.preventDefault();\n\n\t\tconst { onContextMenu } = this.props;\n\n\t\tconst mouseXY = mousePosition(e, this.node.getBoundingClientRect());\n\n\t\tselect(d3Window(this.node))\n\t\t\t.on(MOUSEMOVE, null)\n\t\t\t.on(MOUSEUP, null);\n\t\tthis.setState({\n\t\t\tstartPosition: null,\n\t\t});\n\n\t\tonContextMenu(mouseXY, e);\n\n\t\tthis.contextMenuClicked = true;\n\t}\n\thandleDragStartMouse(e) {\n\t\tthis.mouseInteraction = true;\n\n\t\tconst { getScale, getMoreProps } = this.props;\n\t\tconst startScale = getScale(getMoreProps());\n\t\tthis.dragHappened = false;\n\n\t\tif (startScale.invert) {\n\t\t\tselect(d3Window(this.node))\n\t\t\t\t.on(MOUSEMOVE, this.handleDrag, false)\n\t\t\t\t.on(MOUSEUP, this.handleDragEnd, false);\n\n\t\t\tconst startXY = mousePosition(e);\n\n\t\t\tthis.setState({\n\t\t\t\tstartPosition: {\n\t\t\t\t\tstartXY,\n\t\t\t\t\tstartScale,\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\te.preventDefault();\n\t}\n\thandleDragStartTouch(e) {\n\t\tthis.mouseInteraction = false;\n\n\t\tconst { getScale, getMoreProps } = this.props;\n\t\tconst startScale = getScale(getMoreProps());\n\t\tthis.dragHappened = false;\n\n\t\tif (e.touches.length === 1 && startScale.invert) {\n\t\t\tselect(d3Window(this.node))\n\t\t\t\t.on(TOUCHMOVE, this.handleDrag)\n\t\t\t\t.on(TOUCHEND, this.handleDragEnd);\n\n\t\t\tconst startXY = touchPosition(getTouchProps(e.touches[0]), e);\n\n\t\t\tthis.setState({\n\t\t\t\tstartPosition: {\n\t\t\t\t\tstartXY,\n\t\t\t\t\tstartScale,\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\thandleDrag() {\n\t\tconst { startPosition } = this.state;\n\t\tconst { getMouseDelta, inverted } = this.props;\n\n\t\tthis.dragHappened = true;\n\t\tif (isDefined(startPosition)) {\n\t\t\tconst { startScale } = startPosition;\n\t\t\tconst { startXY } = startPosition;\n\n\t\t\tconst mouseXY = this.mouseInteraction\n\t\t\t\t? mouse(this.node)\n\t\t\t\t: touches(this.node)[0];\n\n\t\t\tconst diff = getMouseDelta(startXY, mouseXY);\n\n\t\t\tconst center = mean(startScale.range());\n\n\t\t\tconst tempRange = startScale.range()\n\t\t\t\t.map(d => inverted ? d - sign(d - center) * diff : d + sign(d - center) * diff);\n\n\t\t\tconst newDomain = tempRange.map(startScale.invert);\n\n\t\t\tif (sign(last(startScale.range()) - first(startScale.range())) === sign(last(tempRange) - first(tempRange))) {\n\n\t\t\t\tconst { axisZoomCallback } = this.props;\n\t\t\t\t// console.log(startXScale.domain(), newXDomain)\n\t\t\t\taxisZoomCallback(newDomain);\n\t\t\t}\n\t\t}\n\t}\n\thandleDragEnd() {\n\n\t\tif (!this.dragHappened) {\n\t\t\tif (this.clicked) {\n\t\t\t\tconst e = d3Event;\n\t\t\t\tconst mouseXY = this.mouseInteraction\n\t\t\t\t\t? mouse(this.node)\n\t\t\t\t\t: touches(this.node)[0];\n\t\t\t\tconst { onDoubleClick } = this.props;\n\n\t\t\t\tonDoubleClick(mouseXY, e);\n\t\t\t} else {\n\t\t\t\tthis.clicked = true;\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.clicked = false;\n\t\t\t\t}, 300);\n\t\t\t}\n\t\t}\n\n\t\tselect(d3Window(this.node))\n\t\t\t.on(MOUSEMOVE, null)\n\t\t\t.on(MOUSEUP, null)\n\t\t\t.on(TOUCHMOVE, null)\n\t\t\t.on(TOUCHEND, null);\n\n\t\tthis.setState({\n\t\t\tstartPosition: null,\n\t\t});\n\t}\n\trender() {\n\t\tconst { bg, className, zoomCursorClassName } = this.props;\n\n\t\tconst cursor = isDefined(this.state.startPosition)\n\t\t\t? zoomCursorClassName\n\t\t\t: \"react-stockcharts-default-cursor\";\n\n\t\treturn <rect\n\t\t\tclassName={`react-stockcharts-enable-interaction ${cursor} ${className}`}\n\t\t\tref={this.saveNode}\n\t\t\tx={bg.x} y={bg.y} opacity={0} height={bg.h} width={bg.w}\n\t\t\tonContextMenu={this.handleRightClick}\n\t\t\tonMouseDown={this.handleDragStartMouse}\n\t\t\tonTouchStart={this.handleDragStartTouch}\n\t\t/>;\n\t}\n}\n\nAxisZoomCapture.propTypes = {\n\tinnerTickSize: PropTypes.number,\n\touterTickSize: PropTypes.number,\n\ttickFormat: PropTypes.func,\n\ttickPadding: PropTypes.number,\n\ttickSize: PropTypes.number,\n\tticks: PropTypes.number,\n\ttickValues: PropTypes.array,\n\tshowDomain: PropTypes.bool,\n\tshowTicks: PropTypes.bool,\n\tclassName: PropTypes.string,\n\taxisZoomCallback: PropTypes.func,\n\tinverted: PropTypes.bool,\n\tbg: PropTypes.object.isRequired,\n\tzoomCursorClassName: PropTypes.string.isRequired,\n\tgetMoreProps: PropTypes.func.isRequired,\n\tgetScale: PropTypes.func.isRequired,\n\tgetMouseDelta: PropTypes.func.isRequired,\n\tonDoubleClick: PropTypes.func.isRequired,\n\tonContextMenu: PropTypes.func.isRequired,\n};\n\nAxisZoomCapture.defaultProps = {\n\tonDoubleClick: noop,\n\tonContextMenu: noop,\n\tinverted: true\n};\n\nexport default AxisZoomCapture;\n"]},"metadata":{},"sourceType":"script"}
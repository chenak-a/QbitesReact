{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nvar _slicedToArray = function () {\n  function sliceIterator(arr, i) {\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _e = undefined;\n\n    try {\n      for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n        _arr.push(_s.value);\n\n        if (i && _arr.length === i) break;\n      }\n    } catch (err) {\n      _d = true;\n      _e = err;\n    } finally {\n      try {\n        if (!_n && _i[\"return\"]) _i[\"return\"]();\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n\n    return _arr;\n  }\n\n  return function (arr, i) {\n    if (Array.isArray(arr)) {\n      return arr;\n    } else if (Symbol.iterator in Object(arr)) {\n      return sliceIterator(arr, i);\n    } else {\n      throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n    }\n  };\n}();\n\nexports.default = function () {\n  var options = _defaultOptionsForComputation.SAR;\n\n  function calculator(data) {\n    var _options = options,\n        accelerationFactor = _options.accelerationFactor,\n        maxAccelerationFactor = _options.maxAccelerationFactor;\n    var algorithm = (0, _utils.mappedSlidingWindow)().windowSize(2).undefinedValue(function (_ref) {\n      var high = _ref.high,\n          low = _ref.low;\n      return {\n        risingSar: low,\n        risingEp: high,\n        fallingSar: high,\n        fallingEp: low,\n        af: accelerationFactor\n      };\n    }).accumulator(function (_ref2) {\n      var _ref3 = _slicedToArray(_ref2, 2),\n          prev = _ref3[0],\n          now = _ref3[1];\n\n      var _calc = calc(prev, now),\n          risingSar = _calc.risingSar,\n          fallingSar = _calc.fallingSar,\n          risingEp = _calc.risingEp,\n          fallingEp = _calc.fallingEp;\n\n      if ((0, _utils.isNotDefined)(prev.use) && risingSar > now.low && fallingSar < now.high) {\n        return {\n          risingSar: risingSar,\n          fallingSar: fallingSar,\n          risingEp: risingEp,\n          fallingEp: fallingEp\n        };\n      }\n\n      var use = (0, _utils.isDefined)(prev.use) ? prev.use === \"rising\" ? risingSar > now.low ? \"falling\" : \"rising\" : fallingSar < now.high ? \"rising\" : \"falling\" : risingSar > now.low ? \"falling\" : \"rising\";\n      var current = prev.use === use ? {\n        af: Math.min(maxAccelerationFactor, prev.af + accelerationFactor),\n        fallingEp: fallingEp,\n        risingEp: risingEp,\n        fallingSar: fallingSar,\n        risingSar: risingSar\n      } : {\n        af: accelerationFactor,\n        fallingEp: now.low,\n        risingEp: now.high,\n        fallingSar: Math.max(prev.risingEp, now.high),\n        risingSar: Math.min(prev.fallingEp, now.low)\n      };\n      var date = now.date,\n          high = now.high,\n          low = now.low;\n      return _extends({\n        date: date,\n        high: high,\n        low: low\n      }, current, {\n        use: use,\n        sar: use === \"falling\" ? current.fallingSar : current.risingSar\n      });\n    });\n    var calculatedData = algorithm(data).map(function (d) {\n      return d.sar;\n    }); // console.log(calculatedData);\n\n    return calculatedData;\n  }\n\n  calculator.undefinedLength = function () {\n    return 1;\n  };\n\n  calculator.options = function (x) {\n    if (!arguments.length) {\n      return options;\n    }\n\n    options = _extends({}, _defaultOptionsForComputation.SAR, x);\n    return calculator;\n  };\n\n  return calculator;\n};\n\nvar _utils = require(\"../utils\");\n\nvar _defaultOptionsForComputation = require(\"./defaultOptionsForComputation\");\n\nfunction calc(prev, now) {\n  var risingSar = prev.risingSar + prev.af * (prev.risingEp - prev.risingSar);\n  var fallingSar = prev.fallingSar - prev.af * (prev.fallingSar - prev.fallingEp);\n  var risingEp = Math.max(prev.risingEp, now.high);\n  var fallingEp = Math.min(prev.fallingEp, now.low);\n  return {\n    risingSar: risingSar,\n    fallingSar: fallingSar,\n    risingEp: risingEp,\n    fallingEp: fallingEp\n  };\n}","map":{"version":3,"sources":["../../../src/lib/calculator/sar.js"],"names":["risingSar","prev","fallingSar","risingEp","Math","now","fallingEp","options","accelerationFactor","maxAccelerationFactor","algorithm","high","low","af","calc","use","current","date","sar","calculatedData","d","calculator","arguments"],"mappings":"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","sourcesContent":["\n\nimport { mappedSlidingWindow, isNotDefined, isDefined } from \"../utils\";\nimport { SAR as defaultOptions } from \"./defaultOptionsForComputation\";\n\nfunction calc(prev, now) {\n\tconst risingSar = prev.risingSar\n\t\t+ prev.af * (prev.risingEp - prev.risingSar);\n\n\tconst fallingSar = prev.fallingSar\n\t\t- prev.af * (prev.fallingSar - prev.fallingEp);\n\n\tconst risingEp = Math.max(prev.risingEp, now.high);\n\tconst fallingEp = Math.min(prev.fallingEp, now.low);\n\n\treturn {\n\t\trisingSar,\n\t\tfallingSar,\n\t\trisingEp,\n\t\tfallingEp,\n\t};\n}\n\nexport default function() {\n\n\tlet options = defaultOptions;\n\n\tfunction calculator(data) {\n\t\tconst { accelerationFactor, maxAccelerationFactor } = options;\n\n\t\tconst algorithm = mappedSlidingWindow()\n\t\t\t.windowSize(2)\n\t\t\t.undefinedValue(({ high, low }) => {\n\t\t\t\treturn {\n\t\t\t\t\trisingSar: low,\n\t\t\t\t\trisingEp: high,\n\t\t\t\t\tfallingSar: high,\n\t\t\t\t\tfallingEp: low,\n\t\t\t\t\taf: accelerationFactor,\n\t\t\t\t};\n\t\t\t})\n\t\t\t.accumulator(([prev, now]) => {\n\n\t\t\t\tconst {\n\t\t\t\t\trisingSar,\n\t\t\t\t\tfallingSar,\n\t\t\t\t\trisingEp,\n\t\t\t\t\tfallingEp,\n\t\t\t\t} = calc(prev, now);\n\n\t\t\t\tif (isNotDefined(prev.use)\n\t\t\t\t\t\t&& risingSar > now.low\n\t\t\t\t\t\t&& fallingSar < now.high) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\trisingSar,\n\t\t\t\t\t\tfallingSar,\n\t\t\t\t\t\trisingEp,\n\t\t\t\t\t\tfallingEp,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tconst use = isDefined(prev.use)\n\t\t\t\t\t? prev.use === \"rising\"\n\t\t\t\t\t\t? risingSar > now.low ? \"falling\" : \"rising\"\n\t\t\t\t\t\t: fallingSar < now.high ? \"rising\" : \"falling\"\n\t\t\t\t\t: risingSar > now.low\n\t\t\t\t\t\t? \"falling\"\n\t\t\t\t\t\t: \"rising\";\n\n\t\t\t\tconst current = prev.use === use\n\t\t\t\t\t? {\n\t\t\t\t\t\taf: Math.min(maxAccelerationFactor, prev.af + accelerationFactor),\n\t\t\t\t\t\tfallingEp,\n\t\t\t\t\t\trisingEp,\n\t\t\t\t\t\tfallingSar,\n\t\t\t\t\t\trisingSar,\n\t\t\t\t\t}\n\t\t\t\t\t: {\n\t\t\t\t\t\taf: accelerationFactor,\n\t\t\t\t\t\tfallingEp: now.low,\n\t\t\t\t\t\trisingEp: now.high,\n\t\t\t\t\t\tfallingSar: Math.max(prev.risingEp, now.high),\n\t\t\t\t\t\trisingSar: Math.min(prev.fallingEp, now.low),\n\t\t\t\t\t};\n\n\t\t\t\tconst { date, high, low } = now;\n\t\t\t\treturn {\n\t\t\t\t\tdate,\n\t\t\t\t\thigh,\n\t\t\t\t\tlow,\n\t\t\t\t\t...current,\n\t\t\t\t\tuse,\n\t\t\t\t\tsar: use === \"falling\" ? current.fallingSar : current.risingSar,\n\t\t\t\t};\n\t\t\t});\n\n\t\tconst calculatedData = algorithm(data).map(d => d.sar);\n\t\t// console.log(calculatedData);\n\n\t\treturn calculatedData;\n\t}\n\tcalculator.undefinedLength = function() {\n\t\treturn 1;\n\t};\n\tcalculator.options = function(x) {\n\t\tif (!arguments.length) {\n\t\t\treturn options;\n\t\t}\n\t\toptions = { ...defaultOptions, ...x };\n\t\treturn calculator;\n\t};\n\n\treturn calculator;\n}\n"]},"metadata":{},"sourceType":"script"}
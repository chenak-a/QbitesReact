{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _slicedToArray = function () {\n  function sliceIterator(arr, i) {\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _e = undefined;\n\n    try {\n      for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n        _arr.push(_s.value);\n\n        if (i && _arr.length === i) break;\n      }\n    } catch (err) {\n      _d = true;\n      _e = err;\n    } finally {\n      try {\n        if (!_n && _i[\"return\"]) _i[\"return\"]();\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n\n    return _arr;\n  }\n\n  return function (arr, i) {\n    if (Array.isArray(arr)) {\n      return arr;\n    } else if (Symbol.iterator in Object(arr)) {\n      return sliceIterator(arr, i);\n    } else {\n      throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n    }\n  };\n}();\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nvar _react = require(\"react\");\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _propTypes = require(\"prop-types\");\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _GenericComponent = require(\"../GenericComponent\");\n\nvar _GenericComponent2 = _interopRequireDefault(_GenericComponent);\n\nvar _d3Array = require(\"d3-array\");\n\nvar _utils = require(\"../utils\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _toConsumableArray(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  } else {\n    return Array.from(arr);\n  }\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n}\n\nvar HoverTooltip = function (_Component) {\n  _inherits(HoverTooltip, _Component);\n\n  function HoverTooltip(props) {\n    _classCallCheck(this, HoverTooltip);\n\n    var _this = _possibleConstructorReturn(this, (HoverTooltip.__proto__ || Object.getPrototypeOf(HoverTooltip)).call(this, props));\n\n    _this.renderSVG = _this.renderSVG.bind(_this);\n    _this.drawOnCanvas = _this.drawOnCanvas.bind(_this);\n    return _this;\n  }\n\n  _createClass(HoverTooltip, [{\n    key: \"drawOnCanvas\",\n    value: function drawOnCanvas(ctx, moreProps) {\n      var pointer = helper(this.props, moreProps, ctx);\n      var height = moreProps.height;\n      if ((0, _utils.isNotDefined)(pointer)) return null;\n\n      _drawOnCanvas(ctx, this.props, this.context, pointer, height, moreProps);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return _react2.default.createElement(_GenericComponent2.default, {\n        svgDraw: this.renderSVG,\n        canvasDraw: this.drawOnCanvas,\n        drawOn: [\"mousemove\", \"pan\"\n        /* , \"mouseleave\" */\n        ]\n      });\n    }\n  }, {\n    key: \"renderSVG\",\n    value: function renderSVG(moreProps) {\n      var pointer = helper(this.props, moreProps);\n      if ((0, _utils.isNotDefined)(pointer)) return null;\n      var _props = this.props,\n          bgFill = _props.bgFill,\n          bgOpacity = _props.bgOpacity,\n          backgroundShapeSVG = _props.backgroundShapeSVG,\n          tooltipSVG = _props.tooltipSVG;\n      var _props2 = this.props,\n          bgheight = _props2.bgheight,\n          bgwidth = _props2.bgwidth;\n      var height = moreProps.height;\n      var x = pointer.x,\n          y = pointer.y,\n          content = pointer.content,\n          centerX = pointer.centerX,\n          pointWidth = pointer.pointWidth,\n          bgSize = pointer.bgSize;\n      var bgShape = (0, _utils.isDefined)(bgwidth) && (0, _utils.isDefined)(bgheight) ? {\n        width: bgwidth,\n        height: bgheight\n      } : bgSize;\n      return _react2.default.createElement(\"g\", null, _react2.default.createElement(\"rect\", {\n        x: centerX - pointWidth / 2,\n        y: 0,\n        width: pointWidth,\n        height: height,\n        fill: bgFill,\n        opacity: bgOpacity\n      }), _react2.default.createElement(\"g\", {\n        className: \"react-stockcharts-tooltip-content\",\n        transform: \"translate(\" + x + \", \" + y + \")\"\n      }, backgroundShapeSVG(this.props, bgShape), tooltipSVG(this.props, content)));\n    }\n  }]);\n\n  return HoverTooltip;\n}(_react.Component);\n\nHoverTooltip.propTypes = {\n  chartId: _propTypes2.default.oneOfType([_propTypes2.default.number, _propTypes2.default.string]),\n  yAccessor: _propTypes2.default.func,\n  tooltipSVG: _propTypes2.default.func,\n  backgroundShapeSVG: _propTypes2.default.func,\n  bgwidth: _propTypes2.default.number,\n  bgheight: _propTypes2.default.number,\n  bgFill: _propTypes2.default.string.isRequired,\n  bgOpacity: _propTypes2.default.number.isRequired,\n  tooltipContent: _propTypes2.default.func.isRequired,\n  origin: _propTypes2.default.oneOfType([_propTypes2.default.array, _propTypes2.default.func]).isRequired,\n  fontFamily: _propTypes2.default.string,\n  fontSize: _propTypes2.default.number\n};\nHoverTooltip.contextTypes = {\n  margin: _propTypes2.default.object.isRequired,\n  ratio: _propTypes2.default.number.isRequired\n};\nHoverTooltip.defaultProps = {\n  // bgwidth: 150,\n  // bgheight: 50,\n  tooltipSVG: tooltipSVG,\n  tooltipCanvas: tooltipCanvas,\n  origin: origin,\n  fill: \"#D4E2FD\",\n  bgFill: \"#D4E2FD\",\n  bgOpacity: 0.5,\n  stroke: \"#9B9BFF\",\n  fontFill: \"#000000\",\n  opacity: 0.8,\n  backgroundShapeSVG: backgroundShapeSVG,\n  backgroundShapeCanvas: backgroundShapeCanvas,\n  fontFamily: \"Helvetica Neue, Helvetica, Arial, sans-serif\",\n  fontSize: 12\n};\nvar PADDING = 5;\nvar X = 10;\nvar Y = 10;\n/* eslint-disable react/prop-types */\n\nfunction backgroundShapeSVG(_ref, _ref2) {\n  var fill = _ref.fill,\n      stroke = _ref.stroke,\n      opacity = _ref.opacity;\n  var height = _ref2.height,\n      width = _ref2.width;\n  return _react2.default.createElement(\"rect\", {\n    height: height,\n    width: width,\n    fill: fill,\n    opacity: opacity,\n    stroke: stroke\n  });\n}\n\nfunction tooltipSVG(_ref3, content) {\n  var fontFamily = _ref3.fontFamily,\n      fontSize = _ref3.fontSize,\n      fontFill = _ref3.fontFill;\n  var tspans = [];\n  var startY = Y + fontSize * 0.9;\n\n  for (var i = 0; i < content.y.length; i++) {\n    var y = content.y[i];\n    var textY = startY + fontSize * (i + 1);\n    tspans.push(_react2.default.createElement(\"tspan\", {\n      key: \"L-\" + i,\n      x: X,\n      y: textY,\n      fill: y.stroke\n    }, y.label));\n    tspans.push(_react2.default.createElement(\"tspan\", {\n      key: i\n    }, \": \"));\n    tspans.push(_react2.default.createElement(\"tspan\", {\n      key: \"V-\" + i\n    }, y.value));\n  }\n\n  return _react2.default.createElement(\"text\", {\n    fontFamily: fontFamily,\n    fontSize: fontSize,\n    fill: fontFill\n  }, _react2.default.createElement(\"tspan\", {\n    x: X,\n    y: startY\n  }, content.x), tspans);\n}\n/* eslint-enable react/prop-types */\n\n\nfunction backgroundShapeCanvas(props, _ref4, ctx) {\n  var width = _ref4.width,\n      height = _ref4.height;\n  var fill = props.fill,\n      stroke = props.stroke,\n      opacity = props.opacity;\n  ctx.fillStyle = (0, _utils.hexToRGBA)(fill, opacity);\n  ctx.strokeStyle = stroke;\n  ctx.beginPath();\n  ctx.rect(0, 0, width, height);\n  ctx.fill();\n  ctx.stroke();\n}\n\nfunction tooltipCanvas(_ref5, content, ctx) {\n  var fontFamily = _ref5.fontFamily,\n      fontSize = _ref5.fontSize,\n      fontFill = _ref5.fontFill;\n  var startY = Y + fontSize * 0.9;\n  ctx.font = fontSize + \"px \" + fontFamily;\n  ctx.fillStyle = fontFill;\n  ctx.textAlign = \"left\";\n  ctx.fillText(content.x, X, startY);\n\n  for (var i = 0; i < content.y.length; i++) {\n    var y = content.y[i];\n    var textY = startY + fontSize * (i + 1);\n    ctx.fillStyle = y.stroke || fontFill;\n    ctx.fillText(y.label, X, textY);\n    ctx.fillStyle = fontFill;\n    ctx.fillText(\": \" + y.value, X + ctx.measureText(y.label).width, textY);\n  }\n}\n\nfunction _drawOnCanvas(ctx, props, context, pointer, height) {\n  var margin = context.margin,\n      ratio = context.ratio;\n  var bgFill = props.bgFill,\n      bgOpacity = props.bgOpacity;\n  var backgroundShapeCanvas = props.backgroundShapeCanvas,\n      tooltipCanvas = props.tooltipCanvas;\n  var originX = 0.5 * ratio + margin.left;\n  var originY = 0.5 * ratio + margin.top;\n  ctx.save();\n  ctx.setTransform(1, 0, 0, 1, 0, 0);\n  ctx.scale(ratio, ratio);\n  ctx.translate(originX, originY);\n  var x = pointer.x,\n      y = pointer.y,\n      content = pointer.content,\n      centerX = pointer.centerX,\n      pointWidth = pointer.pointWidth,\n      bgSize = pointer.bgSize;\n  ctx.fillStyle = (0, _utils.hexToRGBA)(bgFill, bgOpacity);\n  ctx.beginPath();\n  ctx.rect(centerX - pointWidth / 2, 0, pointWidth, height);\n  ctx.fill();\n  ctx.translate(x, y);\n  backgroundShapeCanvas(props, bgSize, ctx);\n  tooltipCanvas(props, content, ctx);\n  ctx.restore();\n}\n\nfunction calculateTooltipSize(_ref6, content, ctx) {\n  var fontFamily = _ref6.fontFamily,\n      fontSize = _ref6.fontSize,\n      fontFill = _ref6.fontFill;\n\n  if ((0, _utils.isNotDefined)(ctx)) {\n    var canvas = document.createElement(\"canvas\");\n    ctx = canvas.getContext(\"2d\");\n  }\n\n  ctx.font = fontSize + \"px \" + fontFamily;\n  ctx.fillStyle = fontFill;\n  ctx.textAlign = \"left\";\n\n  var measureText = function measureText(str) {\n    return {\n      width: ctx.measureText(str).width,\n      height: fontSize\n    };\n  };\n\n  var _content$y$map$reduce = content.y.map(function (_ref7) {\n    var label = _ref7.label,\n        value = _ref7.value;\n    return measureText(label + \": \" + value);\n  }) // Sum all y and x sizes (begin with x label size)\n  .reduce(function (res, size) {\n    return sumSizes(res, size);\n  }, measureText(String(content.x))),\n      width = _content$y$map$reduce.width,\n      height = _content$y$map$reduce.height;\n\n  return {\n    width: width + 2 * X,\n    height: height + 2 * Y\n  };\n}\n\nfunction sumSizes() {\n  for (var _len = arguments.length, sizes = Array(_len), _key = 0; _key < _len; _key++) {\n    sizes[_key] = arguments[_key];\n  }\n\n  return {\n    width: Math.max.apply(Math, _toConsumableArray(sizes.map(function (size) {\n      return size.width;\n    }))),\n    height: (0, _d3Array.sum)(sizes, function (d) {\n      return d.height;\n    })\n  };\n}\n\nfunction normalizeX(x, bgSize, pointWidth, width) {\n  // return x - bgSize.width - pointWidth / 2 - PADDING * 2 < 0\n  return x < width / 2 ? x + pointWidth / 2 + PADDING : x - bgSize.width - pointWidth / 2 - PADDING;\n}\n\nfunction normalizeY(y, bgSize) {\n  return y - bgSize.height <= 0 ? y + PADDING : y - bgSize.height - PADDING;\n}\n\nfunction origin(props, moreProps, bgSize, pointWidth) {\n  var chartId = props.chartId,\n      yAccessor = props.yAccessor;\n  var mouseXY = moreProps.mouseXY,\n      xAccessor = moreProps.xAccessor,\n      currentItem = moreProps.currentItem,\n      xScale = moreProps.xScale,\n      chartConfig = moreProps.chartConfig,\n      width = moreProps.width;\n  var y = (0, _utils.last)(mouseXY);\n  var xValue = xAccessor(currentItem);\n  var x = Math.round(xScale(xValue));\n\n  if ((0, _utils.isDefined)(chartId) && (0, _utils.isDefined)(yAccessor) && (0, _utils.isDefined)(chartConfig) && (0, _utils.isDefined)(chartConfig.findIndex)) {\n    var yValue = yAccessor(currentItem);\n    var chartIndex = chartConfig.findIndex(function (x) {\n      return x.id === chartId;\n    });\n    y = Math.round(chartConfig[chartIndex].yScale(yValue));\n  }\n\n  x = normalizeX(x, bgSize, pointWidth, width);\n  y = normalizeY(y, bgSize);\n  return [x, y];\n}\n\nfunction helper(props, moreProps, ctx) {\n  var show = moreProps.show,\n      xScale = moreProps.xScale,\n      currentItem = moreProps.currentItem,\n      plotData = moreProps.plotData;\n  var origin = props.origin,\n      tooltipContent = props.tooltipContent;\n  var xAccessor = moreProps.xAccessor,\n      displayXAccessor = moreProps.displayXAccessor;\n  if (!show || (0, _utils.isNotDefined)(currentItem)) return;\n  var xValue = xAccessor(currentItem);\n  if (!show || (0, _utils.isNotDefined)(xValue)) return;\n  var content = tooltipContent({\n    currentItem: currentItem,\n    xAccessor: displayXAccessor\n  });\n  var centerX = xScale(xValue);\n  var pointWidth = Math.abs(xScale(xAccessor((0, _utils.last)(plotData))) - xScale(xAccessor((0, _utils.first)(plotData)))) / (plotData.length - 1);\n  var bgSize = calculateTooltipSize(props, content, ctx);\n\n  var _origin = origin(props, moreProps, bgSize, pointWidth),\n      _origin2 = _slicedToArray(_origin, 2),\n      x = _origin2[0],\n      y = _origin2[1];\n\n  return {\n    x: x,\n    y: y,\n    content: content,\n    centerX: centerX,\n    pointWidth: pointWidth,\n    bgSize: bgSize\n  };\n}\n\nexports.default = HoverTooltip;","map":{"version":3,"mappings":"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","names":["HoverTooltip","props","_classCallCheck","_this","renderSVG","bind","drawOnCanvas","ctx","moreProps","pointer","helper","height","context","_react2","svgDraw","canvasDraw","drawOn","bgFill","bgOpacity","backgroundShapeSVG","tooltipSVG","bgheight","bgwidth","x","y","content","centerX","pointWidth","bgSize","bgShape","width","fill","opacity","className","transform","propTypes","chartId","_propTypes2","oneOfType","number","string","yAccessor","func","isRequired","tooltipContent","origin","array","fontFamily","fontSize","contextTypes","margin","object","ratio","defaultProps","tooltipCanvas","stroke","fontFill","backgroundShapeCanvas","PADDING","X","Y","tspans","startY","i","length","textY","push","key","label","value","fillStyle","strokeStyle","beginPath","rect","font","textAlign","fillText","measureText","originX","left","originY","top","save","setTransform","scale","translate","restore","calculateTooltipSize","canvas","document","createElement","getContext","str","map","reduce","res","size","sumSizes","String","sizes","arguments","Math","max","d","normalizeX","normalizeY","mouseXY","xAccessor","currentItem","xScale","chartConfig","xValue","round","findIndex","yValue","chartIndex","id","yScale","show","plotData","displayXAccessor","abs"],"sources":["../../../src/lib/tooltip/HoverTooltip.js"],"sourcesContent":["\n\nimport React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport GenericComponent from \"../GenericComponent\";\nimport { sum } from \"d3-array\";\n\nimport { first, last, isNotDefined, isDefined, hexToRGBA } from \"../utils\";\n\nclass HoverTooltip extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.renderSVG = this.renderSVG.bind(this);\n\t\tthis.drawOnCanvas = this.drawOnCanvas.bind(this);\n\t}\n\tdrawOnCanvas(ctx, moreProps) {\n\t\tconst pointer = helper(this.props, moreProps, ctx);\n\t\tconst { height } = moreProps;\n\n\t\tif (isNotDefined(pointer)) return null;\n\t\tdrawOnCanvas(ctx, this.props, this.context, pointer, height, moreProps);\n\t}\n\trender() {\n\t\treturn <GenericComponent\n\t\t\tsvgDraw={this.renderSVG}\n\t\t\tcanvasDraw={this.drawOnCanvas}\n\t\t\tdrawOn={[\"mousemove\", \"pan\"/* , \"mouseleave\" */]}\n\t\t/>;\n\t}\n\trenderSVG(moreProps) {\n\t\tconst pointer = helper(this.props, moreProps);\n\n\t\tif (isNotDefined(pointer)) return null;\n\n\t\tconst { bgFill, bgOpacity, backgroundShapeSVG, tooltipSVG } = this.props;\n\t\tconst { bgheight, bgwidth } = this.props;\n\t\tconst { height } = moreProps;\n\n\t\tconst { x, y, content, centerX, pointWidth, bgSize } = pointer;\n\n\t\tconst bgShape = isDefined(bgwidth) && isDefined(bgheight)\n\t\t\t? { width: bgwidth, height: bgheight }\n\t\t\t: bgSize;\n\n\t\treturn (\n\t\t\t<g>\n\t\t\t\t<rect x={centerX - pointWidth / 2}\n\t\t\t\t\ty={0}\n\t\t\t\t\twidth={pointWidth}\n\t\t\t\t\theight={height}\n\t\t\t\t\tfill={bgFill}\n\t\t\t\t\topacity={bgOpacity} />\n\t\t\t\t<g className=\"react-stockcharts-tooltip-content\" transform={`translate(${x}, ${y})`}>\n\t\t\t\t\t{backgroundShapeSVG(this.props, bgShape)}\n\t\t\t\t\t{tooltipSVG(this.props, content)}\n\t\t\t\t</g>\n\t\t\t</g>\n\t\t);\n\t}\n}\n\nHoverTooltip.propTypes = {\n\tchartId: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n\tyAccessor: PropTypes.func,\n\ttooltipSVG: PropTypes.func,\n\tbackgroundShapeSVG: PropTypes.func,\n\tbgwidth: PropTypes.number,\n\tbgheight: PropTypes.number,\n\tbgFill: PropTypes.string.isRequired,\n\tbgOpacity: PropTypes.number.isRequired,\n\ttooltipContent: PropTypes.func.isRequired,\n\torigin: PropTypes.oneOfType([\n\t\tPropTypes.array,\n\t\tPropTypes.func\n\t]).isRequired,\n\tfontFamily: PropTypes.string,\n\tfontSize: PropTypes.number,\n};\n\nHoverTooltip.contextTypes = {\n\tmargin: PropTypes.object.isRequired,\n\tratio: PropTypes.number.isRequired,\n};\n\nHoverTooltip.defaultProps = {\n\t// bgwidth: 150,\n\t// bgheight: 50,\n\ttooltipSVG: tooltipSVG,\n\ttooltipCanvas: tooltipCanvas,\n\torigin: origin,\n\tfill: \"#D4E2FD\",\n\tbgFill: \"#D4E2FD\",\n\tbgOpacity: 0.5,\n\tstroke: \"#9B9BFF\",\n\tfontFill: \"#000000\",\n\topacity: 0.8,\n\tbackgroundShapeSVG: backgroundShapeSVG,\n\tbackgroundShapeCanvas: backgroundShapeCanvas,\n\tfontFamily: \"Helvetica Neue, Helvetica, Arial, sans-serif\",\n\tfontSize: 12,\n};\n\nconst PADDING = 5;\nconst X = 10;\nconst Y = 10;\n\n\n/* eslint-disable react/prop-types */\nfunction backgroundShapeSVG({ fill, stroke, opacity }, { height, width }) {\n\treturn <rect\n\t\theight={height}\n\t\twidth={width}\n\t\tfill={fill}\n\t\topacity={opacity}\n\t\tstroke={stroke} />;\n}\n\nfunction tooltipSVG({ fontFamily, fontSize, fontFill }, content) {\n\tconst tspans = [];\n\tconst startY = Y + fontSize * 0.9;\n\n\tfor (let i = 0; i < content.y.length; i++) {\n\t\tconst y = content.y[i];\n\t\tconst textY = startY + (fontSize * (i + 1));\n\n\t\ttspans.push(<tspan key={`L-${i}`} x={X} y={textY} fill={y.stroke}>{y.label}</tspan>);\n\t\ttspans.push(<tspan key={i}>: </tspan>);\n\t\ttspans.push(<tspan key={`V-${i}`}>{y.value}</tspan>);\n\t}\n\treturn <text fontFamily={fontFamily} fontSize={fontSize} fill={fontFill}>\n\t\t<tspan x={X} y={startY}>{content.x}</tspan>\n\t\t{tspans}\n\t</text>;\n}\n/* eslint-enable react/prop-types */\n\nfunction backgroundShapeCanvas(props, { width, height }, ctx) {\n\tconst { fill, stroke, opacity } = props;\n\n\tctx.fillStyle = hexToRGBA(fill, opacity);\n\tctx.strokeStyle = stroke;\n\tctx.beginPath();\n\tctx.rect(0, 0, width, height);\n\tctx.fill();\n\tctx.stroke();\n}\n\nfunction tooltipCanvas({ fontFamily, fontSize, fontFill }, content, ctx) {\n\tconst startY = Y + fontSize * 0.9;\n\tctx.font = `${fontSize}px ${fontFamily}`;\n\tctx.fillStyle = fontFill;\n\tctx.textAlign = \"left\";\n\tctx.fillText(content.x, X, startY);\n\n\tfor (let i = 0; i < content.y.length; i++) {\n\t\tconst y = content.y[i];\n\t\tconst textY = startY + (fontSize * (i + 1));\n\t\tctx.fillStyle = y.stroke || fontFill;\n\t\tctx.fillText(y.label, X, textY);\n\n\t\tctx.fillStyle = fontFill;\n\t\tctx.fillText(\": \" + y.value, X + ctx.measureText(y.label).width, textY);\n\t}\n}\n\nfunction drawOnCanvas(ctx, props, context, pointer, height) {\n\n\tconst { margin, ratio } = context;\n\tconst { bgFill, bgOpacity } = props;\n\tconst { backgroundShapeCanvas, tooltipCanvas } = props;\n\n\tconst originX = 0.5 * ratio + margin.left;\n\tconst originY = 0.5 * ratio + margin.top;\n\n\tctx.save();\n\n\tctx.setTransform(1, 0, 0, 1, 0, 0);\n\tctx.scale(ratio, ratio);\n\n\tctx.translate(originX, originY);\n\n\tconst { x, y, content, centerX, pointWidth, bgSize } = pointer;\n\n\tctx.fillStyle = hexToRGBA(bgFill, bgOpacity);\n\tctx.beginPath();\n\tctx.rect(centerX - pointWidth / 2, 0, pointWidth, height);\n\tctx.fill();\n\n\tctx.translate(x, y);\n\tbackgroundShapeCanvas(props, bgSize, ctx);\n\ttooltipCanvas(props, content, ctx);\n\n\tctx.restore();\n}\n\nfunction calculateTooltipSize({ fontFamily, fontSize, fontFill }, content, ctx) {\n\tif (isNotDefined(ctx)) {\n\t\tconst canvas = document.createElement(\"canvas\");\n\t\tctx = canvas.getContext(\"2d\");\n\t}\n\n\tctx.font = `${fontSize}px ${fontFamily}`;\n\tctx.fillStyle = fontFill;\n\tctx.textAlign = \"left\";\n\n\tconst measureText = str => ({\n\t\twidth: ctx.measureText(str).width,\n\t\theight: fontSize,\n\t});\n\n\tconst { width, height } = content.y\n\t\t.map(({ label, value }) => measureText(`${label}: ${value}`))\n\t\t// Sum all y and x sizes (begin with x label size)\n\t\t.reduce((res, size) => sumSizes(res, size), measureText(String(content.x)))\n\t;\n\n\treturn {\n\t\twidth: width + 2 * X,\n\t\theight: height + 2 * Y\n\t};\n}\n\nfunction sumSizes(...sizes) {\n\treturn {\n\t\twidth: Math.max(...sizes.map(size => size.width)),\n\t\theight: sum(sizes, d => d.height),\n\t};\n}\n\nfunction normalizeX(x, bgSize, pointWidth, width) {\n\t// return x - bgSize.width - pointWidth / 2 - PADDING * 2 < 0\n\treturn x < width / 2\n\t\t? x + pointWidth / 2 + PADDING\n\t\t: x - bgSize.width - pointWidth / 2 - PADDING;\n}\n\nfunction normalizeY(y, bgSize) {\n\treturn y - bgSize.height <= 0\n\t\t? y + PADDING\n\t\t: y - bgSize.height - PADDING;\n}\n\nfunction origin(props, moreProps, bgSize, pointWidth) {\n\tconst { chartId, yAccessor } = props;\n\tconst { mouseXY, xAccessor, currentItem, xScale, chartConfig, width } = moreProps;\n\tlet y = last(mouseXY);\n\n\tconst xValue = xAccessor(currentItem);\n\tlet x = Math.round(xScale(xValue));\n\n\tif (isDefined(chartId) && isDefined(yAccessor)\n\t\t\t&& isDefined(chartConfig) && isDefined(chartConfig.findIndex)) {\n\t\tconst yValue = yAccessor(currentItem);\n\t\tconst chartIndex = chartConfig.findIndex(x => x.id === chartId);\n\n\t\ty = Math.round(chartConfig[chartIndex].yScale(yValue));\n\t}\n\n\tx = normalizeX(x, bgSize, pointWidth, width);\n\ty = normalizeY(y, bgSize);\n\n\treturn [x, y];\n}\n\nfunction helper(props, moreProps, ctx) {\n\tconst { show, xScale, currentItem, plotData } = moreProps;\n\tconst { origin, tooltipContent } = props;\n\tconst { xAccessor, displayXAccessor } = moreProps;\n\n\tif (!show || isNotDefined(currentItem)) return;\n\n\tconst xValue = xAccessor(currentItem);\n\n\tif (!show || isNotDefined(xValue)) return;\n\n\tconst content = tooltipContent({ currentItem, xAccessor: displayXAccessor });\n\tconst centerX = xScale(xValue);\n\tconst pointWidth = Math.abs(xScale(xAccessor(last(plotData))) - xScale(xAccessor(first(plotData)))) / (plotData.length - 1);\n\n\tconst bgSize = calculateTooltipSize(props, content, ctx);\n\n\tconst [x, y] = origin(props, moreProps, bgSize, pointWidth);\n\n\treturn { x, y, content, centerX, pointWidth, bgSize };\n}\n\nexport default HoverTooltip;\n"]},"metadata":{},"sourceType":"script"}
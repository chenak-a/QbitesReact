{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nvar _react = require(\"react\");\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _propTypes = require(\"prop-types\");\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _d3Collection = require(\"d3-collection\");\n\nvar _GenericChartComponent = require(\"../GenericChartComponent\");\n\nvar _GenericChartComponent2 = _interopRequireDefault(_GenericChartComponent);\n\nvar _GenericComponent = require(\"../GenericComponent\");\n\nvar _utils = require(\"../utils\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n}\n\nvar ScatterSeries = function (_Component) {\n  _inherits(ScatterSeries, _Component);\n\n  function ScatterSeries(props) {\n    _classCallCheck(this, ScatterSeries);\n\n    var _this = _possibleConstructorReturn(this, (ScatterSeries.__proto__ || Object.getPrototypeOf(ScatterSeries)).call(this, props));\n\n    _this.renderSVG = _this.renderSVG.bind(_this);\n    _this.drawOnCanvas = _this.drawOnCanvas.bind(_this);\n    return _this;\n  }\n\n  _createClass(ScatterSeries, [{\n    key: \"drawOnCanvas\",\n    value: function drawOnCanvas(ctx, moreProps) {\n      var xAccessor = moreProps.xAccessor;\n      var points = helper(this.props, moreProps, xAccessor);\n\n      _drawOnCanvas(ctx, this.props, points);\n    }\n  }, {\n    key: \"renderSVG\",\n    value: function renderSVG(moreProps) {\n      var _props = this.props,\n          className = _props.className,\n          markerProps = _props.markerProps;\n      var xAccessor = moreProps.xAccessor;\n      var points = helper(this.props, moreProps, xAccessor);\n      return _react2.default.createElement(\"g\", {\n        className: className\n      }, points.map(function (point, idx) {\n        var Marker = point.marker;\n        return _react2.default.createElement(Marker, _extends({\n          key: idx\n        }, markerProps, {\n          point: point\n        }));\n      }));\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return _react2.default.createElement(_GenericChartComponent2.default, {\n        svgDraw: this.renderSVG,\n        canvasDraw: this.drawOnCanvas,\n        canvasToDraw: _GenericComponent.getAxisCanvas,\n        drawOn: [\"pan\"]\n      });\n    }\n  }]);\n\n  return ScatterSeries;\n}(_react.Component);\n\nScatterSeries.propTypes = {\n  className: _propTypes2.default.string,\n  yAccessor: _propTypes2.default.func.isRequired,\n  marker: _propTypes2.default.func,\n  markerProvider: _propTypes2.default.func,\n  markerProps: _propTypes2.default.object\n};\nScatterSeries.defaultProps = {\n  className: \"react-stockcharts-scatter\"\n};\n\nfunction helper(props, moreProps, xAccessor) {\n  var yAccessor = props.yAccessor,\n      markerProvider = props.markerProvider,\n      markerProps = props.markerProps;\n  var Marker = props.marker;\n  var xScale = moreProps.xScale,\n      yScale = moreProps.chartConfig.yScale,\n      plotData = moreProps.plotData;\n  if (!(markerProvider || Marker)) throw new Error(\"required prop, either marker or markerProvider missing\");\n  return plotData.map(function (d) {\n    if (markerProvider) Marker = markerProvider(d);\n\n    var mProps = _extends({}, Marker.defaultProps, markerProps);\n\n    var fill = (0, _utils.functor)(mProps.fill);\n    var stroke = (0, _utils.functor)(mProps.stroke);\n    return {\n      x: xScale(xAccessor(d)),\n      y: yScale(yAccessor(d)),\n      fill: (0, _utils.hexToRGBA)(fill(d), mProps.opacity),\n      stroke: stroke(d),\n      datum: d,\n      marker: Marker\n    };\n  });\n}\n\nfunction _drawOnCanvas(ctx, props, points) {\n  var markerProps = props.markerProps;\n  var nest = (0, _d3Collection.nest)().key(function (d) {\n    return d.fill;\n  }).key(function (d) {\n    return d.stroke;\n  }).entries(points);\n  nest.forEach(function (fillGroup) {\n    var fillKey = fillGroup.key,\n        fillValues = fillGroup.values;\n\n    if (fillKey !== \"none\") {\n      ctx.fillStyle = fillKey;\n    }\n\n    fillValues.forEach(function (strokeGroup) {\n      // var { key: strokeKey, values: strokeValues } = strokeGroup;\n      var strokeValues = strokeGroup.values;\n      strokeValues.forEach(function (point) {\n        var marker = point.marker;\n        marker.drawOnCanvas(_extends({}, marker.defaultProps, markerProps, {\n          fill: fillKey\n        }), point, ctx);\n      });\n    });\n  });\n}\n\nexports.default = ScatterSeries;","map":{"version":3,"sources":["../../../src/lib/series/ScatterSeries.js"],"names":["ScatterSeries","ctx","moreProps","xAccessor","points","helper","drawOnCanvas","className","markerProps","Marker","point","yAccessor","marker","markerProvider","object","props","xScale","yScale","plotData","mProps","fill","stroke","x","y","datum","nest","d","fillKey","fillValues","fillGroup","strokeValues","strokeGroup"],"mappings":"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","sourcesContent":["\n\nimport React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { nest as d3Nest } from \"d3-collection\";\n\nimport GenericChartComponent from \"../GenericChartComponent\";\nimport { getAxisCanvas } from \"../GenericComponent\";\n\nimport { hexToRGBA, functor } from \"../utils\";\n\nclass ScatterSeries extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.renderSVG = this.renderSVG.bind(this);\n\t\tthis.drawOnCanvas = this.drawOnCanvas.bind(this);\n\t}\n\tdrawOnCanvas(ctx, moreProps) {\n\t\tconst { xAccessor } = moreProps;\n\n\t\tconst points = helper(this.props, moreProps, xAccessor);\n\n\t\tdrawOnCanvas(ctx, this.props, points);\n\t}\n\trenderSVG(moreProps) {\n\t\tconst { className, markerProps } = this.props;\n\t\tconst { xAccessor } = moreProps;\n\n\t\tconst points = helper(this.props, moreProps, xAccessor);\n\n\t\treturn <g className={className}>\n\t\t\t{points.map((point, idx) => {\n\t\t\t\tconst { marker: Marker } = point;\n\t\t\t\treturn <Marker key={idx} {...markerProps} point={point} />;\n\t\t\t})}\n\t\t</g>;\n\t}\n\trender() {\n\t\treturn <GenericChartComponent\n\t\t\tsvgDraw={this.renderSVG}\n\t\t\tcanvasDraw={this.drawOnCanvas}\n\t\t\tcanvasToDraw={getAxisCanvas}\n\t\t\tdrawOn={[\"pan\"]}\n\t\t/>;\n\t}\n}\n\nScatterSeries.propTypes = {\n\tclassName: PropTypes.string,\n\tyAccessor: PropTypes.func.isRequired,\n\tmarker: PropTypes.func,\n\tmarkerProvider: PropTypes.func,\n\tmarkerProps: PropTypes.object,\n};\n\nScatterSeries.defaultProps = {\n\tclassName: \"react-stockcharts-scatter\",\n};\n\nfunction helper(props, moreProps, xAccessor) {\n\tconst { yAccessor, markerProvider, markerProps } = props;\n\tlet { marker: Marker } = props;\n\tconst { xScale, chartConfig: { yScale }, plotData } = moreProps;\n\n\tif (!(markerProvider || Marker)) throw new Error(\"required prop, either marker or markerProvider missing\");\n\n\treturn plotData.map(d => {\n\n\t\tif (markerProvider) Marker = markerProvider(d);\n\n\t\tconst mProps = { ...Marker.defaultProps, ...markerProps };\n\n\t\tconst fill = functor(mProps.fill);\n\t\tconst stroke = functor(mProps.stroke);\n\n\t\treturn {\n\t\t\tx: xScale(xAccessor(d)),\n\t\t\ty: yScale(yAccessor(d)),\n\t\t\tfill: hexToRGBA(fill(d), mProps.opacity),\n\t\t\tstroke: stroke(d),\n\t\t\tdatum: d,\n\t\t\tmarker: Marker,\n\t\t};\n\t});\n}\n\nfunction drawOnCanvas(ctx, props, points) {\n\n\tconst { markerProps } = props;\n\n\tconst nest = d3Nest()\n\t\t.key(d => d.fill)\n\t\t.key(d => d.stroke)\n\t\t.entries(points);\n\n\tnest.forEach(fillGroup => {\n\t\tconst { key: fillKey, values: fillValues } = fillGroup;\n\n\t\tif (fillKey !== \"none\") {\n\t\t\tctx.fillStyle = fillKey;\n\t\t}\n\n\t\tfillValues.forEach(strokeGroup => {\n\t\t\t// var { key: strokeKey, values: strokeValues } = strokeGroup;\n\t\t\tconst { values: strokeValues } = strokeGroup;\n\n\t\t\tstrokeValues.forEach(point => {\n\t\t\t\tconst { marker } = point;\n\t\t\t\tmarker.drawOnCanvas({ ...marker.defaultProps, ...markerProps, fill: fillKey }, point, ctx);\n\t\t\t});\n\t\t});\n\t});\n}\n\nexport default ScatterSeries;\n"]},"metadata":{},"sourceType":"script"}
{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nvar _d3Array = require(\"d3-array\");\n\nvar _react = require(\"react\");\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _propTypes = require(\"prop-types\");\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _GenericChartComponent = require(\"../GenericChartComponent\");\n\nvar _GenericChartComponent2 = _interopRequireDefault(_GenericChartComponent);\n\nvar _GenericComponent = require(\"../GenericComponent\");\n\nvar _StackedBarSeries = require(\"./StackedBarSeries\");\n\nvar _utils = require(\"../utils\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n}\n\nvar OverlayBarSeries = function (_Component) {\n  _inherits(OverlayBarSeries, _Component);\n\n  function OverlayBarSeries(props) {\n    _classCallCheck(this, OverlayBarSeries);\n\n    var _this = _possibleConstructorReturn(this, (OverlayBarSeries.__proto__ || Object.getPrototypeOf(OverlayBarSeries)).call(this, props));\n\n    _this.renderSVG = _this.renderSVG.bind(_this);\n    _this.drawOnCanvas = _this.drawOnCanvas.bind(_this);\n    return _this;\n  }\n\n  _createClass(OverlayBarSeries, [{\n    key: \"drawOnCanvas\",\n    value: function drawOnCanvas(ctx, moreProps) {\n      var yAccessor = this.props.yAccessor;\n      var bars = getBars(this.props, moreProps, yAccessor);\n      (0, _StackedBarSeries.drawOnCanvas2)(this.props, ctx, bars);\n    }\n  }, {\n    key: \"renderSVG\",\n    value: function renderSVG(moreProps) {\n      var yAccessor = this.props.yAccessor;\n      var bars = getBars(this.props, moreProps, yAccessor);\n      return _react2.default.createElement(\"g\", {\n        className: \"react-stockcharts-bar-series\"\n      }, (0, _StackedBarSeries.getBarsSVG2)(this.props, bars));\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var clip = this.props.clip;\n      return _react2.default.createElement(_GenericChartComponent2.default, {\n        svgDraw: this.renderSVG,\n        canvasToDraw: _GenericComponent.getAxisCanvas,\n        canvasDraw: this.drawOnCanvas,\n        clip: clip,\n        drawOn: [\"pan\"]\n      });\n    }\n  }]);\n\n  return OverlayBarSeries;\n}(_react.Component);\n\nOverlayBarSeries.propTypes = {\n  baseAt: _propTypes2.default.oneOfType([_propTypes2.default.number, _propTypes2.default.func]).isRequired,\n  direction: _propTypes2.default.oneOf([\"up\", \"down\"]).isRequired,\n  stroke: _propTypes2.default.bool.isRequired,\n  widthRatio: _propTypes2.default.number.isRequired,\n  opacity: _propTypes2.default.number.isRequired,\n  fill: _propTypes2.default.oneOfType([_propTypes2.default.func, _propTypes2.default.string]).isRequired,\n  className: _propTypes2.default.oneOfType([_propTypes2.default.func, _propTypes2.default.string]).isRequired,\n  xAccessor: _propTypes2.default.func,\n  yAccessor: _propTypes2.default.arrayOf(_propTypes2.default.func),\n  xScale: _propTypes2.default.func,\n  yScale: _propTypes2.default.func,\n  plotData: _propTypes2.default.array,\n  clip: _propTypes2.default.bool.isRequired\n};\nOverlayBarSeries.defaultProps = {\n  baseAt: function baseAt(xScale, yScale\n  /* , d*/\n  ) {\n    return (0, _utils.first)(yScale.range());\n  },\n  direction: \"up\",\n  className: \"bar\",\n  stroke: false,\n  fill: \"#4682B4\",\n  opacity: 1,\n  widthRatio: 0.5,\n  width: _utils.plotDataLengthBarWidth,\n  clip: true\n};\n\nfunction getBars(props, moreProps, yAccessor) {\n  var xScale = moreProps.xScale,\n      xAccessor = moreProps.xAccessor,\n      yScale = moreProps.chartConfig.yScale,\n      plotData = moreProps.plotData;\n  var baseAt = props.baseAt,\n      className = props.className,\n      fill = props.fill,\n      stroke = props.stroke;\n  var getClassName = (0, _utils.functor)(className);\n  var getFill = (0, _utils.functor)(fill);\n  var getBase = (0, _utils.functor)(baseAt);\n  var widthFunctor = (0, _utils.functor)(props.width);\n  var width = widthFunctor(props, moreProps);\n  var offset = Math.floor(0.5 * width); // console.log(xScale.domain(), yScale.domain());\n\n  var bars = plotData.map(function (d) {\n    // eslint-disable-next-line prefer-const\n    var innerBars = yAccessor.map(function (eachYAccessor, i) {\n      var yValue = eachYAccessor(d);\n      if ((0, _utils.isNotDefined)(yValue)) return undefined;\n      var xValue = xAccessor(d);\n      var x = Math.round(xScale(xValue)) - offset;\n      var y = yScale(yValue); // console.log(yValue, y, xValue, x)\n\n      return {\n        width: offset * 2,\n        x: x,\n        y: y,\n        className: getClassName(d, i),\n        stroke: stroke ? getFill(d, i) : \"none\",\n        fill: getFill(d, i),\n        i: i\n      };\n    }).filter(function (yValue) {\n      return (0, _utils.isDefined)(yValue);\n    });\n    var b = getBase(xScale, yScale, d);\n    var h = void 0;\n\n    for (var i = innerBars.length - 1; i >= 0; i--) {\n      h = b - innerBars[i].y;\n\n      if (h < 0) {\n        innerBars[i].y = b;\n        h = -1 * h;\n      }\n\n      innerBars[i].height = h;\n      b = innerBars[i].y;\n    }\n\n    return innerBars;\n  });\n  return (0, _d3Array.merge)(bars);\n}\n\nexports.default = OverlayBarSeries;","map":{"version":3,"mappings":"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","names":["OverlayBarSeries","props","_classCallCheck","_this","renderSVG","bind","drawOnCanvas","ctx","moreProps","yAccessor","bars","getBars","_react2","className","clip","svgDraw","canvasToDraw","canvasDraw","drawOn","propTypes","baseAt","_propTypes2","oneOfType","number","func","isRequired","direction","oneOf","stroke","bool","widthRatio","opacity","fill","string","xAccessor","arrayOf","xScale","yScale","plotData","array","defaultProps","range","width","chartConfig","getClassName","getFill","getBase","widthFunctor","offset","Math","floor","map","innerBars","eachYAccessor","i","yValue","d","undefined","xValue","x","round","y","filter","b","h","length","height"],"sources":["../../../src/lib/series/OverlayBarSeries.js"],"sourcesContent":["\n\nimport { merge } from \"d3-array\";\n\nimport React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\n\nimport GenericChartComponent from \"../GenericChartComponent\";\nimport { getAxisCanvas } from \"../GenericComponent\";\n\nimport { drawOnCanvas2, getBarsSVG2 } from \"./StackedBarSeries\";\nimport { isDefined, isNotDefined, first, functor, plotDataLengthBarWidth } from \"../utils\";\n\nclass OverlayBarSeries extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.renderSVG = this.renderSVG.bind(this);\n\t\tthis.drawOnCanvas = this.drawOnCanvas.bind(this);\n\t}\n\tdrawOnCanvas(ctx, moreProps) {\n\t\tconst { yAccessor } = this.props;\n\t\tconst bars = getBars(this.props, moreProps, yAccessor);\n\n\t\tdrawOnCanvas2(this.props, ctx, bars);\n\t}\n\trenderSVG(moreProps) {\n\t\tconst { yAccessor } = this.props;\n\n\t\tconst bars = getBars(this.props, moreProps, yAccessor);\n\t\treturn <g className=\"react-stockcharts-bar-series\">\n\t\t\t{getBarsSVG2(this.props, bars)}\n\t\t</g>;\n\t}\n\trender() {\n\t\tconst { clip } = this.props;\n\n\t\treturn <GenericChartComponent\n\t\t\tsvgDraw={this.renderSVG}\n\t\t\tcanvasToDraw={getAxisCanvas}\n\t\t\tcanvasDraw={this.drawOnCanvas}\n\t\t\tclip={clip}\n\t\t\tdrawOn={[\"pan\"]}\n\t\t/>;\n\t}\n}\n\nOverlayBarSeries.propTypes = {\n\tbaseAt: PropTypes.oneOfType([\n\t\tPropTypes.number,\n\t\tPropTypes.func,\n\t]).isRequired,\n\tdirection: PropTypes.oneOf([\"up\", \"down\"]).isRequired,\n\tstroke: PropTypes.bool.isRequired,\n\twidthRatio: PropTypes.number.isRequired,\n\topacity: PropTypes.number.isRequired,\n\tfill: PropTypes.oneOfType([\n\t\tPropTypes.func, PropTypes.string\n\t]).isRequired,\n\tclassName: PropTypes.oneOfType([\n\t\tPropTypes.func, PropTypes.string\n\t]).isRequired,\n\txAccessor: PropTypes.func,\n\tyAccessor: PropTypes.arrayOf(PropTypes.func),\n\txScale: PropTypes.func,\n\tyScale: PropTypes.func,\n\tplotData: PropTypes.array,\n\tclip: PropTypes.bool.isRequired,\n};\n\nOverlayBarSeries.defaultProps = {\n\tbaseAt: (xScale, yScale/* , d*/) => first(yScale.range()),\n\tdirection: \"up\",\n\tclassName: \"bar\",\n\tstroke: false,\n\tfill: \"#4682B4\",\n\topacity: 1,\n\twidthRatio: 0.5,\n\twidth: plotDataLengthBarWidth,\n\tclip: true,\n};\n\nfunction getBars(props, moreProps, yAccessor) {\n\tconst { xScale, xAccessor, chartConfig: { yScale }, plotData } = moreProps;\n\tconst { baseAt, className, fill, stroke } = props;\n\n\tconst getClassName = functor(className);\n\tconst getFill = functor(fill);\n\tconst getBase = functor(baseAt);\n\tconst widthFunctor = functor(props.width);\n\n\tconst width = widthFunctor(props, moreProps);\n\tconst offset = Math.floor(0.5 * width);\n\n\t// console.log(xScale.domain(), yScale.domain());\n\n\tconst bars = plotData\n\t\t.map(d => {\n\t\t\t// eslint-disable-next-line prefer-const\n\t\t\tlet innerBars = yAccessor.map((eachYAccessor, i) => {\n\t\t\t\tconst yValue = eachYAccessor(d);\n\t\t\t\tif (isNotDefined(yValue)) return undefined;\n\n\t\t\t\tconst xValue = xAccessor(d);\n\t\t\t\tconst x = Math.round(xScale(xValue)) - offset;\n\t\t\t\tconst y = yScale(yValue);\n\t\t\t\t// console.log(yValue, y, xValue, x)\n\t\t\t\treturn {\n\t\t\t\t\twidth: offset * 2,\n\t\t\t\t\tx: x,\n\t\t\t\t\ty: y,\n\t\t\t\t\tclassName: getClassName(d, i),\n\t\t\t\t\tstroke: stroke ? getFill(d, i) : \"none\",\n\t\t\t\t\tfill: getFill(d, i),\n\t\t\t\t\ti,\n\t\t\t\t};\n\t\t\t}).filter(yValue => isDefined(yValue));\n\n\t\t\tlet b = getBase(xScale, yScale, d);\n\t\t\tlet h;\n\t\t\tfor (let i = innerBars.length - 1; i >= 0; i--) {\n\t\t\t\th = b - innerBars[i].y;\n\t\t\t\tif (h < 0) {\n\t\t\t\t\tinnerBars[i].y = b;\n\t\t\t\t\th = -1 * h;\n\t\t\t\t}\n\t\t\t\tinnerBars[i].height = h;\n\t\t\t\tb = innerBars[i].y;\n\t\t\t}\n\t\t\treturn innerBars;\n\t\t});\n\n\treturn merge(bars);\n}\n\nexport default OverlayBarSeries;\n"]},"metadata":{},"sourceType":"script"}
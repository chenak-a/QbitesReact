{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nvar _d3Collection = require(\"d3-collection\");\n\nvar _react = require(\"react\");\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _propTypes = require(\"prop-types\");\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _GenericChartComponent = require(\"../GenericChartComponent\");\n\nvar _GenericChartComponent2 = _interopRequireDefault(_GenericChartComponent);\n\nvar _GenericComponent = require(\"../GenericComponent\");\n\nvar _utils = require(\"../utils\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n}\n\nvar CandlestickSeries = function (_Component) {\n  _inherits(CandlestickSeries, _Component);\n\n  function CandlestickSeries(props) {\n    _classCallCheck(this, CandlestickSeries);\n\n    var _this = _possibleConstructorReturn(this, (CandlestickSeries.__proto__ || Object.getPrototypeOf(CandlestickSeries)).call(this, props));\n\n    _this.renderSVG = _this.renderSVG.bind(_this);\n    _this.drawOnCanvas = _this.drawOnCanvas.bind(_this);\n    return _this;\n  }\n\n  _createClass(CandlestickSeries, [{\n    key: \"drawOnCanvas\",\n    value: function drawOnCanvas(ctx, moreProps) {\n      _drawOnCanvas(ctx, this.props, moreProps);\n    }\n  }, {\n    key: \"renderSVG\",\n    value: function renderSVG(moreProps) {\n      var _props = this.props,\n          className = _props.className,\n          wickClassName = _props.wickClassName,\n          candleClassName = _props.candleClassName;\n      var xScale = moreProps.xScale,\n          yScale = moreProps.chartConfig.yScale,\n          plotData = moreProps.plotData,\n          xAccessor = moreProps.xAccessor;\n      var candleData = getCandleData(this.props, xAccessor, xScale, yScale, plotData);\n      return _react2.default.createElement(\"g\", {\n        className: className\n      }, _react2.default.createElement(\"g\", {\n        className: wickClassName,\n        key: \"wicks\"\n      }, getWicksSVG(candleData)), _react2.default.createElement(\"g\", {\n        className: candleClassName,\n        key: \"candles\"\n      }, getCandlesSVG(this.props, candleData)));\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var clip = this.props.clip;\n      return _react2.default.createElement(_GenericChartComponent2.default, {\n        clip: clip,\n        svgDraw: this.renderSVG,\n        canvasDraw: this.drawOnCanvas,\n        canvasToDraw: _GenericComponent.getAxisCanvas,\n        drawOn: [\"pan\"]\n      });\n    }\n  }]);\n\n  return CandlestickSeries;\n}(_react.Component);\n\nCandlestickSeries.propTypes = {\n  className: _propTypes2.default.string,\n  wickClassName: _propTypes2.default.string,\n  candleClassName: _propTypes2.default.string,\n  widthRatio: _propTypes2.default.number,\n  width: _propTypes2.default.oneOfType([_propTypes2.default.number, _propTypes2.default.func]),\n  classNames: _propTypes2.default.oneOfType([_propTypes2.default.func, _propTypes2.default.string]),\n  fill: _propTypes2.default.oneOfType([_propTypes2.default.func, _propTypes2.default.string]),\n  stroke: _propTypes2.default.oneOfType([_propTypes2.default.func, _propTypes2.default.string]),\n  wickStroke: _propTypes2.default.oneOfType([_propTypes2.default.func, _propTypes2.default.string]),\n  yAccessor: _propTypes2.default.func,\n  clip: _propTypes2.default.bool\n};\nCandlestickSeries.defaultProps = {\n  className: \"react-stockcharts-candlestick\",\n  wickClassName: \"react-stockcharts-candlestick-wick\",\n  candleClassName: \"react-stockcharts-candlestick-candle\",\n  yAccessor: function yAccessor(d) {\n    return {\n      open: d.open,\n      high: d.high,\n      low: d.low,\n      close: d.close\n    };\n  },\n  classNames: function classNames(d) {\n    return d.close > d.open ? \"up\" : \"down\";\n  },\n  width: _utils.plotDataLengthBarWidth,\n  wickStroke: \"#000000\",\n  // wickStroke: d => d.close > d.open ? \"#6BA583\" : \"#FF0000\",\n  fill: function fill(d) {\n    return d.close > d.open ? \"#6BA583\" : \"#FF0000\";\n  },\n  // stroke: d => d.close > d.open ? \"#6BA583\" : \"#FF0000\",\n  stroke: \"#000000\",\n  candleStrokeWidth: 0.5,\n  // stroke: \"none\",\n  widthRatio: 0.8,\n  opacity: 0.5,\n  clip: true\n};\n\nfunction getWicksSVG(candleData) {\n  var wicks = candleData.map(function (each, idx) {\n    var d = each.wick;\n    return _react2.default.createElement(\"path\", {\n      key: idx,\n      className: each.className,\n      stroke: d.stroke,\n      d: \"M\" + d.x + \",\" + d.y1 + \" L\" + d.x + \",\" + d.y2 + \" M\" + d.x + \",\" + d.y3 + \" L\" + d.x + \",\" + d.y4\n    });\n  });\n  return wicks;\n}\n\nfunction getCandlesSVG(props, candleData) {\n  /* eslint-disable react/prop-types */\n  var opacity = props.opacity,\n      candleStrokeWidth = props.candleStrokeWidth;\n  /* eslint-enable react/prop-types */\n\n  var candles = candleData.map(function (d, idx) {\n    if (d.width <= 1) return _react2.default.createElement(\"line\", {\n      className: d.className,\n      key: idx,\n      x1: d.x,\n      y1: d.y,\n      x2: d.x,\n      y2: d.y + d.height,\n      stroke: d.fill\n    });else if (d.height === 0) return _react2.default.createElement(\"line\", {\n      key: idx,\n      x1: d.x,\n      y1: d.y,\n      x2: d.x + d.width,\n      y2: d.y + d.height,\n      stroke: d.fill\n    });\n    return _react2.default.createElement(\"rect\", {\n      key: idx,\n      className: d.className,\n      fillOpacity: opacity,\n      x: d.x,\n      y: d.y,\n      width: d.width,\n      height: d.height,\n      fill: d.fill,\n      stroke: d.stroke,\n      strokeWidth: candleStrokeWidth\n    });\n  });\n  return candles;\n}\n\nfunction _drawOnCanvas(ctx, props, moreProps) {\n  var opacity = props.opacity,\n      candleStrokeWidth = props.candleStrokeWidth;\n  var xScale = moreProps.xScale,\n      yScale = moreProps.chartConfig.yScale,\n      plotData = moreProps.plotData,\n      xAccessor = moreProps.xAccessor; // const wickData = getWickData(props, xAccessor, xScale, yScale, plotData);\n\n  var candleData = getCandleData(props, xAccessor, xScale, yScale, plotData);\n  var wickNest = (0, _d3Collection.nest)().key(function (d) {\n    return d.wick.stroke;\n  }).entries(candleData);\n  wickNest.forEach(function (outer) {\n    var key = outer.key,\n        values = outer.values;\n    ctx.strokeStyle = key;\n    ctx.fillStyle = key;\n    values.forEach(function (each) {\n      /*\n      ctx.moveTo(d.x, d.y1);\n      ctx.lineTo(d.x, d.y2);\n      \tctx.beginPath();\n      ctx.moveTo(d.x, d.y3);\n      ctx.lineTo(d.x, d.y4);\n      ctx.stroke(); */\n      var d = each.wick;\n      ctx.fillRect(d.x - 0.5, d.y1, 1, d.y2 - d.y1);\n      ctx.fillRect(d.x - 0.5, d.y3, 1, d.y4 - d.y3);\n    });\n  }); // const candleData = getCandleData(props, xAccessor, xScale, yScale, plotData);\n\n  var candleNest = (0, _d3Collection.nest)().key(function (d) {\n    return d.stroke;\n  }).key(function (d) {\n    return d.fill;\n  }).entries(candleData);\n  candleNest.forEach(function (outer) {\n    var strokeKey = outer.key,\n        strokeValues = outer.values;\n\n    if (strokeKey !== \"none\") {\n      ctx.strokeStyle = strokeKey;\n      ctx.lineWidth = candleStrokeWidth;\n    }\n\n    strokeValues.forEach(function (inner) {\n      var key = inner.key,\n          values = inner.values;\n      var fillStyle = (0, _utils.head)(values).width <= 1 ? key : (0, _utils.hexToRGBA)(key, opacity);\n      ctx.fillStyle = fillStyle;\n      values.forEach(function (d) {\n        if (d.width <= 1) {\n          // <line className={d.className} key={idx} x1={d.x} y1={d.y} x2={d.x} y2={d.y + d.height}/>\n\n          /*\n          ctx.beginPath();\n          ctx.moveTo(d.x, d.y);\n          ctx.lineTo(d.x, d.y + d.height);\n          ctx.stroke();\n          */\n          ctx.fillRect(d.x - 0.5, d.y, 1, d.height);\n        } else if (d.height === 0) {\n          // <line key={idx} x1={d.x} y1={d.y} x2={d.x + d.width} y2={d.y + d.height} />\n\n          /*\n          ctx.beginPath();\n          ctx.moveTo(d.x, d.y);\n          ctx.lineTo(d.x + d.width, d.y + d.height);\n          ctx.stroke();\n          */\n          ctx.fillRect(d.x, d.y - 0.5, d.width, 1);\n        } else {\n          /*\n          ctx.beginPath();\n          ctx.rect(d.x, d.y, d.width, d.height);\n          ctx.closePath();\n          ctx.fill();\n          if (strokeKey !== \"none\") ctx.stroke();\n          */\n          ctx.fillRect(d.x, d.y, d.width, d.height);\n          if (strokeKey !== \"none\") ctx.strokeRect(d.x, d.y, d.width, d.height);\n        }\n      });\n    });\n  });\n}\n/*\nfunction getWickData(props, xAccessor, xScale, yScale, plotData) {\n\n\tconst { classNames: classNameProp, wickStroke: wickStrokeProp, yAccessor } = props;\n\tconst wickStroke = functor(wickStrokeProp);\n\tconst className = functor(classNameProp);\n\tconst wickData = plotData\n\t\t\t.filter(d => isDefined(yAccessor(d).close))\n\t\t\t.map(d => {\n\t\t\t\t// console.log(yAccessor);\n\t\t\t\tconst ohlc = yAccessor(d);\n\n\t\t\t\tconst x = Math.round(xScale(xAccessor(d))),\n\t\t\t\t\ty1 = yScale(ohlc.high),\n\t\t\t\t\ty2 = yScale(Math.max(ohlc.open, ohlc.close)),\n\t\t\t\t\ty3 = yScale(Math.min(ohlc.open, ohlc.close)),\n\t\t\t\t\ty4 = yScale(ohlc.low);\n\n\t\t\t\treturn {\n\t\t\t\t\tx,\n\t\t\t\t\ty1,\n\t\t\t\t\ty2,\n\t\t\t\t\ty3,\n\t\t\t\t\ty4,\n\t\t\t\t\tclassName: className(ohlc),\n\t\t\t\t\tdirection: (ohlc.close - ohlc.open),\n\t\t\t\t\tstroke: wickStroke(ohlc),\n\t\t\t\t};\n\t\t\t});\n\treturn wickData;\n}\n*/\n\n\nfunction getCandleData(props, xAccessor, xScale, yScale, plotData) {\n  var wickStrokeProp = props.wickStroke;\n  var wickStroke = (0, _utils.functor)(wickStrokeProp);\n  var classNames = props.classNames,\n      fillProp = props.fill,\n      strokeProp = props.stroke,\n      yAccessor = props.yAccessor;\n  var className = (0, _utils.functor)(classNames);\n  var fill = (0, _utils.functor)(fillProp);\n  var stroke = (0, _utils.functor)(strokeProp);\n  var widthFunctor = (0, _utils.functor)(props.width);\n  var width = widthFunctor(props, {\n    xScale: xScale,\n    xAccessor: xAccessor,\n    plotData: plotData\n  });\n  /*\n  const candleWidth = Math.round(width);\n  const offset = Math.round(candleWidth === 1 ? 0 : 0.5 * width);\n  */\n\n  var trueOffset = 0.5 * width;\n  var offset = trueOffset > 0.7 ? Math.round(trueOffset) : Math.floor(trueOffset); // eslint-disable-next-line prefer-const\n\n  var candles = [];\n\n  for (var i = 0; i < plotData.length; i++) {\n    var d = plotData[i];\n\n    if ((0, _utils.isDefined)(yAccessor(d).close)) {\n      var x = Math.round(xScale(xAccessor(d))); // const x = Math.round(xScale(xAccessor(d)) - offset);\n\n      var ohlc = yAccessor(d);\n      var y = Math.round(yScale(Math.max(ohlc.open, ohlc.close)));\n      var height = Math.round(Math.abs(yScale(ohlc.open) - yScale(ohlc.close)));\n      candles.push({\n        // type: \"line\"\n        x: x - offset,\n        y: y,\n        wick: {\n          stroke: wickStroke(ohlc),\n          x: x,\n          y1: Math.round(yScale(ohlc.high)),\n          y2: y,\n          y3: y + height,\n          // Math.round(yScale(Math.min(ohlc.open, ohlc.close))),\n          y4: Math.round(yScale(ohlc.low))\n        },\n        height: height,\n        width: offset * 2,\n        className: className(ohlc),\n        fill: fill(ohlc),\n        stroke: stroke(ohlc),\n        direction: ohlc.close - ohlc.open\n      });\n    }\n  }\n\n  return candles;\n}\n\nexports.default = CandlestickSeries;","map":{"version":3,"mappings":"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","names":["CandlestickSeries","props","_classCallCheck","_this","renderSVG","bind","drawOnCanvas","ctx","moreProps","className","wickClassName","candleClassName","xScale","yScale","chartConfig","plotData","xAccessor","candleData","getCandleData","_react2","key","getWicksSVG","getCandlesSVG","clip","svgDraw","canvasDraw","canvasToDraw","drawOn","propTypes","_propTypes2","string","widthRatio","number","width","oneOfType","func","classNames","fill","stroke","wickStroke","yAccessor","bool","defaultProps","open","d","high","low","close","candleStrokeWidth","opacity","wicks","map","each","idx","wick","x","y1","y2","y3","y4","candles","x1","y","x2","height","fillOpacity","strokeWidth","wickNest","entries","forEach","outer","values","strokeStyle","fillStyle","fillRect","candleNest","strokeKey","strokeValues","lineWidth","inner","strokeRect","wickStrokeProp","fillProp","strokeProp","widthFunctor","trueOffset","offset","Math","round","floor","i","length","ohlc","max","abs","push","direction"],"sources":["../../../src/lib/series/CandlestickSeries.js"],"sourcesContent":["\n\nimport { nest } from \"d3-collection\";\n\nimport React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\n\nimport GenericChartComponent from \"../GenericChartComponent\";\nimport { getAxisCanvas } from \"../GenericComponent\";\n\nimport {\n\thexToRGBA, isDefined, functor, plotDataLengthBarWidth, head\n} from \"../utils\";\n\nclass CandlestickSeries extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.renderSVG = this.renderSVG.bind(this);\n\t\tthis.drawOnCanvas = this.drawOnCanvas.bind(this);\n\t}\n\tdrawOnCanvas(ctx, moreProps) {\n\t\tdrawOnCanvas(ctx, this.props, moreProps);\n\t}\n\trenderSVG(moreProps) {\n\t\tconst { className, wickClassName, candleClassName } = this.props;\n\t\tconst { xScale, chartConfig: { yScale }, plotData, xAccessor } = moreProps;\n\n\t\tconst candleData = getCandleData(this.props, xAccessor, xScale, yScale, plotData);\n\n\t\treturn <g className={className}>\n\t\t\t<g className={wickClassName} key=\"wicks\">\n\t\t\t\t{getWicksSVG(candleData)}\n\t\t\t</g>\n\t\t\t<g className={candleClassName} key=\"candles\">\n\t\t\t\t{getCandlesSVG(this.props, candleData)}\n\t\t\t</g>\n\t\t</g>;\n\t}\n\n\trender() {\n\t\tconst { clip } = this.props;\n\t\treturn <GenericChartComponent\n\t\t\tclip={clip}\n\t\t\tsvgDraw={this.renderSVG}\n\t\t\tcanvasDraw={this.drawOnCanvas}\n\t\t\tcanvasToDraw={getAxisCanvas}\n\t\t\tdrawOn={[\"pan\"]}\n\t\t/>;\n\t}\n}\n\nCandlestickSeries.propTypes = {\n\tclassName: PropTypes.string,\n\twickClassName: PropTypes.string,\n\tcandleClassName: PropTypes.string,\n\twidthRatio: PropTypes.number,\n\twidth: PropTypes.oneOfType([\n\t\tPropTypes.number,\n\t\tPropTypes.func\n\t]),\n\tclassNames: PropTypes.oneOfType([\n\t\tPropTypes.func,\n\t\tPropTypes.string\n\t]),\n\tfill: PropTypes.oneOfType([\n\t\tPropTypes.func,\n\t\tPropTypes.string\n\t]),\n\tstroke: PropTypes.oneOfType([\n\t\tPropTypes.func,\n\t\tPropTypes.string\n\t]),\n\twickStroke: PropTypes.oneOfType([\n\t\tPropTypes.func,\n\t\tPropTypes.string\n\t]),\n\tyAccessor: PropTypes.func,\n\tclip: PropTypes.bool,\n};\n\nCandlestickSeries.defaultProps = {\n\tclassName: \"react-stockcharts-candlestick\",\n\twickClassName: \"react-stockcharts-candlestick-wick\",\n\tcandleClassName: \"react-stockcharts-candlestick-candle\",\n\tyAccessor: d => ({ open: d.open, high: d.high, low: d.low, close: d.close }),\n\tclassNames: d => d.close > d.open ? \"up\" : \"down\",\n\twidth: plotDataLengthBarWidth,\n\twickStroke: \"#000000\",\n\t// wickStroke: d => d.close > d.open ? \"#6BA583\" : \"#FF0000\",\n\tfill: d => d.close > d.open ? \"#6BA583\" : \"#FF0000\",\n\t// stroke: d => d.close > d.open ? \"#6BA583\" : \"#FF0000\",\n\tstroke: \"#000000\",\n\tcandleStrokeWidth: 0.5,\n\t// stroke: \"none\",\n\twidthRatio: 0.8,\n\topacity: 0.5,\n\tclip: true,\n};\n\nfunction getWicksSVG(candleData) {\n\n\tconst wicks = candleData\n\t\t.map((each, idx) => {\n\t\t\tconst d = each.wick;\n\t\t\treturn <path key={idx}\n\t\t\t\tclassName={each.className}\n\t\t\t\tstroke={d.stroke}\n\t\t\t\td={`M${d.x},${d.y1} L${d.x},${d.y2} M${d.x},${d.y3} L${d.x},${d.y4}`} />;\n\t\t});\n\n\treturn wicks;\n}\n\nfunction getCandlesSVG(props, candleData) {\n\n\t/* eslint-disable react/prop-types */\n\tconst { opacity, candleStrokeWidth } = props;\n\t/* eslint-enable react/prop-types */\n\n\tconst candles = candleData.map((d, idx) => {\n\t\tif (d.width <= 1)\n\t\t\treturn (\n\t\t\t\t<line className={d.className} key={idx}\n\t\t\t\t\tx1={d.x} y1={d.y} x2={d.x} y2={d.y + d.height}\n\t\t\t\t\tstroke={d.fill} />\n\t\t\t);\n\t\telse if (d.height === 0)\n\t\t\treturn (\n\t\t\t\t<line key={idx}\n\t\t\t\t\tx1={d.x} y1={d.y} x2={d.x + d.width} y2={d.y + d.height}\n\t\t\t\t\tstroke={d.fill} />\n\t\t\t);\n\t\treturn (\n\t\t\t<rect key={idx} className={d.className}\n\t\t\t\tfillOpacity={opacity}\n\t\t\t\tx={d.x} y={d.y} width={d.width} height={d.height}\n\t\t\t\tfill={d.fill} stroke={d.stroke} strokeWidth={candleStrokeWidth} />\n\t\t);\n\t});\n\treturn candles;\n}\n\nfunction drawOnCanvas(ctx, props, moreProps) {\n\tconst { opacity, candleStrokeWidth } = props;\n\tconst { xScale, chartConfig: { yScale }, plotData, xAccessor } = moreProps;\n\n\t// const wickData = getWickData(props, xAccessor, xScale, yScale, plotData);\n\tconst candleData = getCandleData(props, xAccessor, xScale, yScale, plotData);\n\n\tconst wickNest = nest()\n\t\t.key(d => d.wick.stroke)\n\t\t.entries(candleData);\n\n\twickNest.forEach(outer => {\n\t\tconst { key, values } = outer;\n\t\tctx.strokeStyle = key;\n\t\tctx.fillStyle = key;\n\t\tvalues.forEach(each => {\n\t\t\t/*\n\t\t\tctx.moveTo(d.x, d.y1);\n\t\t\tctx.lineTo(d.x, d.y2);\n\n\t\t\tctx.beginPath();\n\t\t\tctx.moveTo(d.x, d.y3);\n\t\t\tctx.lineTo(d.x, d.y4);\n\t\t\tctx.stroke(); */\n\t\t\tconst d = each.wick;\n\n\t\t\tctx.fillRect(d.x - 0.5, d.y1, 1, d.y2 - d.y1);\n\t\t\tctx.fillRect(d.x - 0.5, d.y3, 1, d.y4 - d.y3);\n\t\t});\n\t});\n\n\t// const candleData = getCandleData(props, xAccessor, xScale, yScale, plotData);\n\n\tconst candleNest = nest()\n\t\t.key(d => d.stroke)\n\t\t.key(d => d.fill)\n\t\t.entries(candleData);\n\n\n\tcandleNest.forEach(outer => {\n\t\tconst { key: strokeKey, values: strokeValues } = outer;\n\t\tif (strokeKey !== \"none\") {\n\t\t\tctx.strokeStyle = strokeKey;\n\t\t\tctx.lineWidth = candleStrokeWidth;\n\t\t}\n\t\tstrokeValues.forEach(inner => {\n\t\t\tconst { key, values } = inner;\n\t\t\tconst fillStyle = head(values).width <= 1\n\t\t\t\t? key\n\t\t\t\t: hexToRGBA(key, opacity);\n\t\t\tctx.fillStyle = fillStyle;\n\n\t\t\tvalues.forEach(d => {\n\t\t\t\tif (d.width <= 1) {\n\t\t\t\t\t// <line className={d.className} key={idx} x1={d.x} y1={d.y} x2={d.x} y2={d.y + d.height}/>\n\t\t\t\t\t/*\n\t\t\t\t\tctx.beginPath();\n\t\t\t\t\tctx.moveTo(d.x, d.y);\n\t\t\t\t\tctx.lineTo(d.x, d.y + d.height);\n\t\t\t\t\tctx.stroke();\n\t\t\t\t\t*/\n\t\t\t\t\tctx.fillRect(d.x - 0.5, d.y, 1, d.height);\n\t\t\t\t} else if (d.height === 0) {\n\t\t\t\t\t// <line key={idx} x1={d.x} y1={d.y} x2={d.x + d.width} y2={d.y + d.height} />\n\t\t\t\t\t/*\n\t\t\t\t\tctx.beginPath();\n\t\t\t\t\tctx.moveTo(d.x, d.y);\n\t\t\t\t\tctx.lineTo(d.x + d.width, d.y + d.height);\n\t\t\t\t\tctx.stroke();\n\t\t\t\t\t*/\n\t\t\t\t\tctx.fillRect(d.x, d.y - 0.5, d.width, 1);\n\t\t\t\t} else {\n\t\t\t\t\t/*\n\t\t\t\t\tctx.beginPath();\n\t\t\t\t\tctx.rect(d.x, d.y, d.width, d.height);\n\t\t\t\t\tctx.closePath();\n\t\t\t\t\tctx.fill();\n\t\t\t\t\tif (strokeKey !== \"none\") ctx.stroke();\n\t\t\t\t\t*/\n\t\t\t\t\tctx.fillRect(d.x, d.y, d.width, d.height);\n\t\t\t\t\tif (strokeKey !== \"none\") ctx.strokeRect(d.x, d.y, d.width, d.height);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t});\n}\n/*\nfunction getWickData(props, xAccessor, xScale, yScale, plotData) {\n\n\tconst { classNames: classNameProp, wickStroke: wickStrokeProp, yAccessor } = props;\n\tconst wickStroke = functor(wickStrokeProp);\n\tconst className = functor(classNameProp);\n\tconst wickData = plotData\n\t\t\t.filter(d => isDefined(yAccessor(d).close))\n\t\t\t.map(d => {\n\t\t\t\t// console.log(yAccessor);\n\t\t\t\tconst ohlc = yAccessor(d);\n\n\t\t\t\tconst x = Math.round(xScale(xAccessor(d))),\n\t\t\t\t\ty1 = yScale(ohlc.high),\n\t\t\t\t\ty2 = yScale(Math.max(ohlc.open, ohlc.close)),\n\t\t\t\t\ty3 = yScale(Math.min(ohlc.open, ohlc.close)),\n\t\t\t\t\ty4 = yScale(ohlc.low);\n\n\t\t\t\treturn {\n\t\t\t\t\tx,\n\t\t\t\t\ty1,\n\t\t\t\t\ty2,\n\t\t\t\t\ty3,\n\t\t\t\t\ty4,\n\t\t\t\t\tclassName: className(ohlc),\n\t\t\t\t\tdirection: (ohlc.close - ohlc.open),\n\t\t\t\t\tstroke: wickStroke(ohlc),\n\t\t\t\t};\n\t\t\t});\n\treturn wickData;\n}\n*/\n\nfunction getCandleData(props, xAccessor, xScale, yScale, plotData) {\n\n\tconst { wickStroke: wickStrokeProp } = props;\n\tconst wickStroke = functor(wickStrokeProp);\n\n\tconst { classNames, fill: fillProp, stroke: strokeProp, yAccessor } = props;\n\tconst className = functor(classNames);\n\n\tconst fill = functor(fillProp);\n\tconst stroke = functor(strokeProp);\n\n\tconst widthFunctor = functor(props.width);\n\tconst width = widthFunctor(props, {\n\t\txScale,\n\t\txAccessor,\n\t\tplotData\n\t});\n\n\t/*\n\tconst candleWidth = Math.round(width);\n\tconst offset = Math.round(candleWidth === 1 ? 0 : 0.5 * width);\n\t*/\n\tconst trueOffset = 0.5 * width;\n\tconst offset = trueOffset > 0.7\n\t\t? Math.round(trueOffset)\n\t\t: Math.floor(trueOffset);\n\n\t// eslint-disable-next-line prefer-const\n\tlet candles = [];\n\n\tfor (let i = 0; i < plotData.length; i++) {\n\t\tconst d = plotData[i];\n\t\tif (isDefined(yAccessor(d).close)) {\n\t\t\tconst x = Math.round(xScale(xAccessor(d)));\n\t\t\t// const x = Math.round(xScale(xAccessor(d)) - offset);\n\n\t\t\tconst ohlc = yAccessor(d);\n\t\t\tconst y = Math.round(yScale(Math.max(ohlc.open, ohlc.close)));\n\t\t\tconst height = Math.round(Math.abs(yScale(ohlc.open) - yScale(ohlc.close)));\n\n\t\t\tcandles.push({\n\t\t\t\t// type: \"line\"\n\t\t\t\tx: x - offset,\n\t\t\t\ty: y,\n\t\t\t\twick: {\n\t\t\t\t\tstroke: wickStroke(ohlc),\n\t\t\t\t\tx: x,\n\t\t\t\t\ty1: Math.round(yScale(ohlc.high)),\n\t\t\t\t\ty2: y,\n\t\t\t\t\ty3: y + height, // Math.round(yScale(Math.min(ohlc.open, ohlc.close))),\n\t\t\t\t\ty4: Math.round(yScale(ohlc.low)),\n\t\t\t\t},\n\t\t\t\theight: height,\n\t\t\t\twidth: offset * 2,\n\t\t\t\tclassName: className(ohlc),\n\t\t\t\tfill: fill(ohlc),\n\t\t\t\tstroke: stroke(ohlc),\n\t\t\t\tdirection: (ohlc.close - ohlc.open),\n\t\t\t});\n\t\t}\n\t}\n\n\treturn candles;\n}\n\nexport default CandlestickSeries;\n"]},"metadata":{},"sourceType":"script"}
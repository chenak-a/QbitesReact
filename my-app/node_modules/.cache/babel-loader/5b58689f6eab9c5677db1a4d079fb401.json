{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _slicedToArray = function () {\n  function sliceIterator(arr, i) {\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _e = undefined;\n\n    try {\n      for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n        _arr.push(_s.value);\n\n        if (i && _arr.length === i) break;\n      }\n    } catch (err) {\n      _d = true;\n      _e = err;\n    } finally {\n      try {\n        if (!_n && _i[\"return\"]) _i[\"return\"]();\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n\n    return _arr;\n  }\n\n  return function (arr, i) {\n    if (Array.isArray(arr)) {\n      return arr;\n    } else if (Symbol.iterator in Object(arr)) {\n      return sliceIterator(arr, i);\n    } else {\n      throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n    }\n  };\n}();\n\nexports.default = function () {\n  var macdSource = void 0,\n      emaSource = void 0;\n  var base = (0, _baseIndicator2.default)().type(ALGORITHM_TYPE) // .stroke(d => stroke[d.elderImpulse])\n  .stroke(_defaultOptionsForAppearance.ElderImpulse.stroke).fill(undefined);\n  var underlyingAlgorithm = (0, _utils.slidingWindow)().windowSize(2).undefinedValue(\"neutral\").accumulator(function (_ref) {\n    var _ref2 = _slicedToArray(_ref, 2),\n        prev = _ref2[0],\n        curr = _ref2[1];\n\n    if ((0, _utils.isNotDefined)(macdSource)) throw new Error(\"macdSource not defined for \" + ALGORITHM_TYPE + \" calculator\");\n    if ((0, _utils.isNotDefined)(emaSource)) throw new Error(\"emaSource not defined for \" + ALGORITHM_TYPE + \" calculator\");\n\n    if ((0, _utils.isDefined)(macdSource(prev)) && (0, _utils.isDefined)(emaSource(prev))) {\n      var prevMACDDivergence = macdSource(prev).divergence;\n      var currMACDDivergence = macdSource(curr).divergence;\n      var prevEMA = emaSource(prev);\n      var currEMA = emaSource(curr);\n      if (currMACDDivergence >= prevMACDDivergence && currEMA >= prevEMA) return \"up\";\n      if (currMACDDivergence <= prevMACDDivergence && currEMA <= prevEMA) return \"down\";\n    }\n\n    return \"neutral\";\n  });\n  var mergedAlgorithm = (0, _utils.merge)().algorithm(underlyingAlgorithm).merge(function (datum, indicator) {\n    datum.elderImpulse = indicator;\n  }); // eslint-disable-next-line prefer-const\n\n  var indicator = function indicator(data) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n      merge: true\n    };\n    var newData = options.merge ? mergedAlgorithm(data) : underlyingAlgorithm(data);\n    return newData;\n  };\n\n  indicator.macdSource = function (x) {\n    if (!arguments.length) return macdSource;\n    macdSource = x;\n    return indicator;\n  };\n\n  indicator.emaSource = function (x) {\n    if (!arguments.length) return emaSource;\n    emaSource = x;\n    return indicator;\n  };\n\n  (0, _utils.rebind)(indicator, base, \"id\", \"echo\", \"type\", \"stroke\"); // rebind(indicator, underlyingAlgorithm, \"windowSize\", \"movingAverageType\", \"multiplier\", \"source\");\n\n  (0, _utils.rebind)(indicator, mergedAlgorithm, \"merge\", \"skipUndefined\");\n  return indicator;\n};\n\nvar _utils = require(\"../utils\");\n\nvar _defaultOptionsForAppearance = require(\"./defaultOptionsForAppearance\");\n\nvar _baseIndicator = require(\"./baseIndicator\");\n\nvar _baseIndicator2 = _interopRequireDefault(_baseIndicator);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar ALGORITHM_TYPE = \"ElderImpulse\";","map":{"version":3,"sources":["../../../src/lib/indicator/elderImpulse.js"],"names":["ALGORITHM_TYPE","macdSource","emaSource","base","underlyingAlgorithm","prev","curr","prevMACDDivergence","currMACDDivergence","prevEMA","currEMA","mergedAlgorithm","datum","indicator","options","merge","newData","arguments"],"mappings":"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","sourcesContent":["\n\nimport { rebind, isDefined, isNotDefined, merge, slidingWindow } from \"../utils\";\n\nimport { ElderImpulse as appearanceOptions } from \"./defaultOptionsForAppearance\";\nimport baseIndicator from \"./baseIndicator\";\n\nconst ALGORITHM_TYPE = \"ElderImpulse\";\n\nexport default function() {\n\n\tlet macdSource, emaSource;\n\n\tconst base = baseIndicator()\n\t\t.type(ALGORITHM_TYPE)\n\t\t// .stroke(d => stroke[d.elderImpulse])\n\t\t.stroke(appearanceOptions.stroke)\n\t\t.fill(undefined);\n\n\tconst underlyingAlgorithm = slidingWindow()\n\t\t.windowSize(2)\n\t\t.undefinedValue(\"neutral\")\n\t\t.accumulator(([prev, curr]) => {\n\t\t\tif (isNotDefined(macdSource)) throw new Error(`macdSource not defined for ${ALGORITHM_TYPE} calculator`);\n\t\t\tif (isNotDefined(emaSource)) throw new Error(`emaSource not defined for ${ALGORITHM_TYPE} calculator`);\n\n\t\t\tif (isDefined(macdSource(prev)) && isDefined(emaSource(prev))) {\n\t\t\t\tconst prevMACDDivergence = macdSource(prev).divergence;\n\t\t\t\tconst currMACDDivergence = macdSource(curr).divergence;\n\n\t\t\t\tconst prevEMA = emaSource(prev);\n\t\t\t\tconst currEMA = emaSource(curr);\n\n\t\t\t\tif (currMACDDivergence >= prevMACDDivergence\n\t\t\t\t\t&& currEMA >= prevEMA) return \"up\";\n\n\t\t\t\tif (currMACDDivergence <= prevMACDDivergence\n\t\t\t\t\t&& currEMA <= prevEMA) return \"down\";\n\t\t\t}\n\t\t\treturn \"neutral\";\n\t\t});\n\n\tconst mergedAlgorithm = merge()\n\t\t.algorithm(underlyingAlgorithm)\n\t\t.merge((datum, indicator) => { datum.elderImpulse = indicator; });\n\n\t// eslint-disable-next-line prefer-const\n\tlet indicator = function(data, options = { merge: true }) {\n\t\tconst newData = options.merge\n\t\t\t? mergedAlgorithm(data)\n\t\t\t: underlyingAlgorithm(data);\n\n\t\treturn newData;\n\t};\n\tindicator.macdSource = function(x) {\n\t\tif (!arguments.length) return macdSource;\n\t\tmacdSource = x;\n\t\treturn indicator;\n\t};\n\tindicator.emaSource = function(x) {\n\t\tif (!arguments.length) return emaSource;\n\t\temaSource = x;\n\t\treturn indicator;\n\t};\n\trebind(indicator, base, \"id\", \"echo\", \"type\", \"stroke\");\n\t// rebind(indicator, underlyingAlgorithm, \"windowSize\", \"movingAverageType\", \"multiplier\", \"source\");\n\trebind(indicator, mergedAlgorithm, \"merge\", \"skipUndefined\");\n\n\treturn indicator;\n}\n"]},"metadata":{},"sourceType":"script"}
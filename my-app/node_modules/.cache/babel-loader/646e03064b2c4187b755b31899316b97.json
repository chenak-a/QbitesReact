{"ast":null,"code":"import noop from \"./noop\";\nimport identity from \"./identity\";\nimport { functor } from \"./index\";\nexport default function () {\n  var undefinedValue = undefined,\n      windowSize = 10,\n      accumulator = noop,\n      source = identity,\n      skipInitial = 0; // eslint-disable-next-line prefer-const\n\n  var mappedSlidingWindow = function mappedSlidingWindow(data) {\n    var size = functor(windowSize).apply(this, arguments);\n    var windowData = [];\n    var accumulatorIdx = 0;\n    var undef = functor(undefinedValue); // console.log(skipInitial, size, data.length, windowData.length);\n\n    var result = [];\n    data.forEach(function (d, i) {\n      // console.log(d, i, windowData.length);\n      var mapped = void 0;\n\n      if (i < skipInitial + size - 1) {\n        mapped = undef(d, i);\n        result.push(mapped);\n        windowData.push(mapped);\n        return;\n      }\n\n      if (i >= skipInitial + size) {\n        // Treat windowData as FIFO rolling buffer\n        windowData.shift();\n      }\n\n      windowData.push(source(d, i));\n      mapped = accumulator(windowData, i, accumulatorIdx++);\n      result.push(mapped);\n      windowData.pop();\n      windowData.push(mapped);\n      return;\n    });\n    return result;\n  };\n\n  mappedSlidingWindow.undefinedValue = function (x) {\n    if (!arguments.length) {\n      return undefinedValue;\n    }\n\n    undefinedValue = x;\n    return mappedSlidingWindow;\n  };\n\n  mappedSlidingWindow.windowSize = function (x) {\n    if (!arguments.length) {\n      return windowSize;\n    }\n\n    windowSize = x;\n    return mappedSlidingWindow;\n  };\n\n  mappedSlidingWindow.accumulator = function (x) {\n    if (!arguments.length) {\n      return accumulator;\n    }\n\n    accumulator = x;\n    return mappedSlidingWindow;\n  };\n\n  mappedSlidingWindow.skipInitial = function (x) {\n    if (!arguments.length) {\n      return skipInitial;\n    }\n\n    skipInitial = x;\n    return mappedSlidingWindow;\n  };\n\n  mappedSlidingWindow.source = function (x) {\n    if (!arguments.length) {\n      return source;\n    }\n\n    source = x;\n    return mappedSlidingWindow;\n  };\n\n  return mappedSlidingWindow;\n}","map":{"version":3,"sources":["../../../../src/lib/utils/mappedSlidingWindow.js"],"names":["undefinedValue","windowSize","accumulator","source","skipInitial","mappedSlidingWindow","size","functor","windowData","accumulatorIdx","undef","result","data","mapped","i","arguments"],"mappings":"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","sourcesContent":["\n\nimport noop from \"./noop\";\nimport identity from \"./identity\";\nimport { functor } from \"./index\";\n\nexport default function() {\n\n\tlet undefinedValue = undefined,\n\t\twindowSize = 10,\n\t\taccumulator = noop,\n\t\tsource = identity,\n\t\tskipInitial = 0;\n\n\t// eslint-disable-next-line prefer-const\n\tlet mappedSlidingWindow = function(data) {\n\t\tconst size = functor(windowSize).apply(this, arguments);\n\t\tconst windowData = [];\n\t\tlet accumulatorIdx = 0;\n\t\tconst undef = functor(undefinedValue);\n\t\t// console.log(skipInitial, size, data.length, windowData.length);\n\t\tconst result = [];\n\t\tdata.forEach(function(d, i) {\n\t\t\t// console.log(d, i, windowData.length);\n\t\t\tlet mapped;\n\t\t\tif (i < (skipInitial + size - 1)) {\n\t\t\t\tmapped = undef(d, i);\n\t\t\t\tresult.push(mapped);\n\t\t\t\twindowData.push(mapped);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (i >= (skipInitial + size)) {\n\t\t\t\t// Treat windowData as FIFO rolling buffer\n\t\t\t\twindowData.shift();\n\t\t\t}\n\t\t\twindowData.push(source(d, i));\n\t\t\tmapped = accumulator(windowData, i, accumulatorIdx++);\n\t\t\tresult.push(mapped);\n\t\t\twindowData.pop();\n\t\t\twindowData.push(mapped);\n\t\t\treturn;\n\t\t});\n\t\treturn result;\n\t};\n\n\tmappedSlidingWindow.undefinedValue = function(x) {\n\t\tif (!arguments.length) {\n\t\t\treturn undefinedValue;\n\t\t}\n\t\tundefinedValue = x;\n\t\treturn mappedSlidingWindow;\n\t};\n\tmappedSlidingWindow.windowSize = function(x) {\n\t\tif (!arguments.length) {\n\t\t\treturn windowSize;\n\t\t}\n\t\twindowSize = x;\n\t\treturn mappedSlidingWindow;\n\t};\n\tmappedSlidingWindow.accumulator = function(x) {\n\t\tif (!arguments.length) {\n\t\t\treturn accumulator;\n\t\t}\n\t\taccumulator = x;\n\t\treturn mappedSlidingWindow;\n\t};\n\tmappedSlidingWindow.skipInitial = function(x) {\n\t\tif (!arguments.length) {\n\t\t\treturn skipInitial;\n\t\t}\n\t\tskipInitial = x;\n\t\treturn mappedSlidingWindow;\n\t};\n\tmappedSlidingWindow.source = function(x) {\n\t\tif (!arguments.length) {\n\t\t\treturn source;\n\t\t}\n\t\tsource = x;\n\t\treturn mappedSlidingWindow;\n\t};\n\n\treturn mappedSlidingWindow;\n}"]},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"'use strict';\n\n(function () {\n  var out$ = typeof exports != 'undefined' && exports || typeof define != 'undefined' && {} || this || window;\n  if (typeof define !== 'undefined') define('save-svg-as-png', [], function () {\n    return out$;\n  });\n  out$.default = out$;\n  var xmlNs = 'http://www.w3.org/2000/xmlns/';\n  var xhtmlNs = 'http://www.w3.org/1999/xhtml';\n  var svgNs = 'http://www.w3.org/2000/svg';\n  var doctype = '<?xml version=\"1.0\" standalone=\"no\"?><!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\" [<!ENTITY nbsp \"&#160;\">]>';\n  var urlRegex = /url\\([\"']?(.+?)[\"']?\\)/;\n  var fontFormats = {\n    woff2: 'font/woff2',\n    woff: 'font/woff',\n    otf: 'application/x-font-opentype',\n    ttf: 'application/x-font-ttf',\n    eot: 'application/vnd.ms-fontobject',\n    sfnt: 'application/font-sfnt',\n    svg: 'image/svg+xml'\n  };\n\n  var isElement = function isElement(obj) {\n    return obj instanceof HTMLElement || obj instanceof SVGElement;\n  };\n\n  var requireDomNode = function requireDomNode(el) {\n    if (!isElement(el)) throw new Error('an HTMLElement or SVGElement is required; got ' + el);\n  };\n\n  var requireDomNodePromise = function requireDomNodePromise(el) {\n    return new Promise(function (resolve, reject) {\n      if (isElement(el)) resolve(el);else reject(new Error('an HTMLElement or SVGElement is required; got ' + el));\n    });\n  };\n\n  var isExternal = function isExternal(url) {\n    return url && url.lastIndexOf('http', 0) === 0 && url.lastIndexOf(window.location.host) === -1;\n  };\n\n  var getFontMimeTypeFromUrl = function getFontMimeTypeFromUrl(fontUrl) {\n    var formats = Object.keys(fontFormats).filter(function (extension) {\n      return fontUrl.indexOf('.' + extension) > 0;\n    }).map(function (extension) {\n      return fontFormats[extension];\n    });\n    if (formats) return formats[0];\n    console.error('Unknown font format for ' + fontUrl + '. Fonts may not be working correctly.');\n    return 'application/octet-stream';\n  };\n\n  var arrayBufferToBase64 = function arrayBufferToBase64(buffer) {\n    var binary = '';\n    var bytes = new Uint8Array(buffer);\n\n    for (var i = 0; i < bytes.byteLength; i++) {\n      binary += String.fromCharCode(bytes[i]);\n    }\n\n    return window.btoa(binary);\n  };\n\n  var getDimension = function getDimension(el, clone, dim) {\n    var v = el.viewBox && el.viewBox.baseVal && el.viewBox.baseVal[dim] || clone.getAttribute(dim) !== null && !clone.getAttribute(dim).match(/%$/) && parseInt(clone.getAttribute(dim)) || el.getBoundingClientRect()[dim] || parseInt(clone.style[dim]) || parseInt(window.getComputedStyle(el).getPropertyValue(dim));\n    return typeof v === 'undefined' || v === null || isNaN(parseFloat(v)) ? 0 : v;\n  };\n\n  var getDimensions = function getDimensions(el, clone, width, height) {\n    if (el.tagName === 'svg') return {\n      width: width || getDimension(el, clone, 'width'),\n      height: height || getDimension(el, clone, 'height')\n    };else if (el.getBBox) {\n      var _el$getBBox = el.getBBox(),\n          x = _el$getBBox.x,\n          y = _el$getBBox.y,\n          _width = _el$getBBox.width,\n          _height = _el$getBBox.height;\n\n      return {\n        width: x + _width,\n        height: y + _height\n      };\n    }\n  };\n\n  var reEncode = function reEncode(data) {\n    return decodeURIComponent(encodeURIComponent(data).replace(/%([0-9A-F]{2})/g, function (match, p1) {\n      var c = String.fromCharCode('0x' + p1);\n      return c === '%' ? '%25' : c;\n    }));\n  };\n\n  var uriToBlob = function uriToBlob(uri) {\n    var byteString = window.atob(uri.split(',')[1]);\n    var mimeString = uri.split(',')[0].split(':')[1].split(';')[0];\n    var buffer = new ArrayBuffer(byteString.length);\n    var intArray = new Uint8Array(buffer);\n\n    for (var i = 0; i < byteString.length; i++) {\n      intArray[i] = byteString.charCodeAt(i);\n    }\n\n    return new Blob([buffer], {\n      type: mimeString\n    });\n  };\n\n  var query = function query(el, selector) {\n    if (!selector) return;\n\n    try {\n      return el.querySelector(selector) || el.parentNode && el.parentNode.querySelector(selector);\n    } catch (err) {\n      console.warn('Invalid CSS selector \"' + selector + '\"', err);\n    }\n  };\n\n  var detectCssFont = function detectCssFont(rule, href) {\n    // Match CSS font-face rules to external links.\n    // @font-face {\n    //   src: local('Abel'), url(https://fonts.gstatic.com/s/abel/v6/UzN-iejR1VoXU2Oc-7LsbvesZW2xOQ-xsNqO47m55DA.woff2);\n    // }\n    var match = rule.cssText.match(urlRegex);\n    var url = match && match[1] || '';\n    if (!url || url.match(/^data:/) || url === 'about:blank') return;\n    var fullUrl = url.startsWith('../') ? href + '/../' + url : url.startsWith('./') ? href + '/.' + url : url;\n    return {\n      text: rule.cssText,\n      format: getFontMimeTypeFromUrl(fullUrl),\n      url: fullUrl\n    };\n  };\n\n  var inlineImages = function inlineImages(el) {\n    return Promise.all(Array.from(el.querySelectorAll('image')).map(function (image) {\n      var href = image.getAttributeNS('http://www.w3.org/1999/xlink', 'href') || image.getAttribute('href');\n      if (!href) return Promise.resolve(null);\n\n      if (isExternal(href)) {\n        href += (href.indexOf('?') === -1 ? '?' : '&') + 't=' + new Date().valueOf();\n      }\n\n      return new Promise(function (resolve, reject) {\n        var canvas = document.createElement('canvas');\n        var img = new Image();\n        img.crossOrigin = 'anonymous';\n        img.src = href;\n\n        img.onerror = function () {\n          return reject(new Error('Could not load ' + href));\n        };\n\n        img.onload = function () {\n          canvas.width = img.width;\n          canvas.height = img.height;\n          canvas.getContext('2d').drawImage(img, 0, 0);\n          image.setAttributeNS('http://www.w3.org/1999/xlink', 'href', canvas.toDataURL('image/png'));\n          resolve(true);\n        };\n      });\n    }));\n  };\n\n  var cachedFonts = {};\n\n  var inlineFonts = function inlineFonts(fonts) {\n    return Promise.all(fonts.map(function (font) {\n      return new Promise(function (resolve, reject) {\n        if (cachedFonts[font.url]) return resolve(cachedFonts[font.url]);\n        var req = new XMLHttpRequest();\n        req.addEventListener('load', function () {\n          // TODO: it may also be worth it to wait until fonts are fully loaded before\n          // attempting to rasterize them. (e.g. use https://developer.mozilla.org/en-US/docs/Web/API/FontFaceSet)\n          var fontInBase64 = arrayBufferToBase64(req.response);\n          var fontUri = font.text.replace(urlRegex, 'url(\"data:' + font.format + ';base64,' + fontInBase64 + '\")') + '\\n';\n          cachedFonts[font.url] = fontUri;\n          resolve(fontUri);\n        });\n        req.addEventListener('error', function (e) {\n          console.warn('Failed to load font from: ' + font.url, e);\n          cachedFonts[font.url] = null;\n          resolve(null);\n        });\n        req.addEventListener('abort', function (e) {\n          console.warn('Aborted loading font from: ' + font.url, e);\n          resolve(null);\n        });\n        req.open('GET', font.url);\n        req.responseType = 'arraybuffer';\n        req.send();\n      });\n    })).then(function (fontCss) {\n      return fontCss.filter(function (x) {\n        return x;\n      }).join('');\n    });\n  };\n\n  var cachedRules = null;\n\n  var styleSheetRules = function styleSheetRules() {\n    if (cachedRules) return cachedRules;\n    return cachedRules = Array.from(document.styleSheets).map(function (sheet) {\n      try {\n        return {\n          rules: sheet.cssRules,\n          href: sheet.href\n        };\n      } catch (e) {\n        console.warn('Stylesheet could not be loaded: ' + sheet.href, e);\n        return {};\n      }\n    });\n  };\n\n  var inlineCss = function inlineCss(el, options) {\n    var _ref = options || {},\n        selectorRemap = _ref.selectorRemap,\n        modifyStyle = _ref.modifyStyle,\n        modifyCss = _ref.modifyCss,\n        fonts = _ref.fonts,\n        excludeUnusedCss = _ref.excludeUnusedCss;\n\n    var generateCss = modifyCss || function (selector, properties) {\n      var sel = selectorRemap ? selectorRemap(selector) : selector;\n      var props = modifyStyle ? modifyStyle(properties) : properties;\n      return sel + '{' + props + '}\\n';\n    };\n\n    var css = [];\n    var detectFonts = typeof fonts === 'undefined';\n    var fontList = fonts || [];\n    styleSheetRules().forEach(function (_ref2) {\n      var rules = _ref2.rules,\n          href = _ref2.href;\n      if (!rules) return;\n      Array.from(rules).forEach(function (rule) {\n        if (typeof rule.style != 'undefined') {\n          if (query(el, rule.selectorText)) css.push(generateCss(rule.selectorText, rule.style.cssText));else if (detectFonts && rule.cssText.match(/^@font-face/)) {\n            var font = detectCssFont(rule, href);\n            if (font) fontList.push(font);\n          } else if (!excludeUnusedCss) {\n            css.push(rule.cssText);\n          }\n        }\n      });\n    });\n    return inlineFonts(fontList).then(function (fontCss) {\n      return css.join('\\n') + fontCss;\n    });\n  };\n\n  var downloadOptions = function downloadOptions() {\n    if (!navigator.msSaveOrOpenBlob && !('download' in document.createElement('a'))) {\n      return {\n        popup: window.open()\n      };\n    }\n  };\n\n  out$.prepareSvg = function (el, options, done) {\n    requireDomNode(el);\n\n    var _ref3 = options || {},\n        _ref3$left = _ref3.left,\n        left = _ref3$left === undefined ? 0 : _ref3$left,\n        _ref3$top = _ref3.top,\n        top = _ref3$top === undefined ? 0 : _ref3$top,\n        w = _ref3.width,\n        h = _ref3.height,\n        _ref3$scale = _ref3.scale,\n        scale = _ref3$scale === undefined ? 1 : _ref3$scale,\n        _ref3$responsive = _ref3.responsive,\n        responsive = _ref3$responsive === undefined ? false : _ref3$responsive,\n        _ref3$excludeCss = _ref3.excludeCss,\n        excludeCss = _ref3$excludeCss === undefined ? false : _ref3$excludeCss;\n\n    return inlineImages(el).then(function () {\n      var clone = el.cloneNode(true);\n      clone.style.backgroundColor = (options || {}).backgroundColor || el.style.backgroundColor;\n\n      var _getDimensions = getDimensions(el, clone, w, h),\n          width = _getDimensions.width,\n          height = _getDimensions.height;\n\n      if (el.tagName !== 'svg') {\n        if (el.getBBox) {\n          if (clone.getAttribute('transform') != null) {\n            clone.setAttribute('transform', clone.getAttribute('transform').replace(/translate\\(.*?\\)/, ''));\n          }\n\n          var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n          svg.appendChild(clone);\n          clone = svg;\n        } else {\n          console.error('Attempted to render non-SVG element', el);\n          return;\n        }\n      }\n\n      clone.setAttribute('version', '1.1');\n      clone.setAttribute('viewBox', [left, top, width, height].join(' '));\n      if (!clone.getAttribute('xmlns')) clone.setAttributeNS(xmlNs, 'xmlns', svgNs);\n      if (!clone.getAttribute('xmlns:xlink')) clone.setAttributeNS(xmlNs, 'xmlns:xlink', 'http://www.w3.org/1999/xlink');\n\n      if (responsive) {\n        clone.removeAttribute('width');\n        clone.removeAttribute('height');\n        clone.setAttribute('preserveAspectRatio', 'xMinYMin meet');\n      } else {\n        clone.setAttribute('width', width * scale);\n        clone.setAttribute('height', height * scale);\n      }\n\n      Array.from(clone.querySelectorAll('foreignObject > *')).forEach(function (foreignObject) {\n        foreignObject.setAttributeNS(xmlNs, 'xmlns', foreignObject.tagName === 'svg' ? svgNs : xhtmlNs);\n      });\n\n      if (excludeCss) {\n        var outer = document.createElement('div');\n        outer.appendChild(clone);\n        var src = outer.innerHTML;\n        if (typeof done === 'function') done(src, width, height);else return {\n          src: src,\n          width: width,\n          height: height\n        };\n      } else {\n        return inlineCss(el, options).then(function (css) {\n          var style = document.createElement('style');\n          style.setAttribute('type', 'text/css');\n          style.innerHTML = '<![CDATA[\\n' + css + '\\n]]>';\n          var defs = document.createElement('defs');\n          defs.appendChild(style);\n          clone.insertBefore(defs, clone.firstChild);\n          var outer = document.createElement('div');\n          outer.appendChild(clone);\n          var src = outer.innerHTML.replace(/NS\\d+:href/gi, 'xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href');\n          if (typeof done === 'function') done(src, width, height);else return {\n            src: src,\n            width: width,\n            height: height\n          };\n        });\n      }\n    });\n  };\n\n  out$.svgAsDataUri = function (el, options, done) {\n    requireDomNode(el);\n    return out$.prepareSvg(el, options).then(function (_ref4) {\n      var src = _ref4.src,\n          width = _ref4.width,\n          height = _ref4.height;\n      var svgXml = 'data:image/svg+xml;base64,' + window.btoa(reEncode(doctype + src));\n\n      if (typeof done === 'function') {\n        done(svgXml, width, height);\n      }\n\n      return svgXml;\n    });\n  };\n\n  out$.svgAsPngUri = function (el, options, done) {\n    requireDomNode(el);\n\n    var _ref5 = options || {},\n        _ref5$encoderType = _ref5.encoderType,\n        encoderType = _ref5$encoderType === undefined ? 'image/png' : _ref5$encoderType,\n        _ref5$encoderOptions = _ref5.encoderOptions,\n        encoderOptions = _ref5$encoderOptions === undefined ? 0.8 : _ref5$encoderOptions,\n        canvg = _ref5.canvg;\n\n    var convertToPng = function convertToPng(_ref6) {\n      var src = _ref6.src,\n          width = _ref6.width,\n          height = _ref6.height;\n      var canvas = document.createElement('canvas');\n      var context = canvas.getContext('2d');\n      var pixelRatio = window.devicePixelRatio || 1;\n      canvas.width = width * pixelRatio;\n      canvas.height = height * pixelRatio;\n      canvas.style.width = canvas.width + 'px';\n      canvas.style.height = canvas.height + 'px';\n      context.setTransform(pixelRatio, 0, 0, pixelRatio, 0, 0);\n      if (canvg) canvg(canvas, src);else context.drawImage(src, 0, 0);\n      var png = void 0;\n\n      try {\n        png = canvas.toDataURL(encoderType, encoderOptions);\n      } catch (e) {\n        if (typeof SecurityError !== 'undefined' && e instanceof SecurityError || e.name === 'SecurityError') {\n          console.error('Rendered SVG images cannot be downloaded in this browser.');\n          return;\n        } else throw e;\n      }\n\n      if (typeof done === 'function') done(png, canvas.width, canvas.height);\n      return Promise.resolve(png);\n    };\n\n    if (canvg) return out$.prepareSvg(el, options).then(convertToPng);else return out$.svgAsDataUri(el, options).then(function (uri) {\n      return new Promise(function (resolve, reject) {\n        var image = new Image();\n\n        image.onload = function () {\n          return resolve(convertToPng({\n            src: image,\n            width: image.width,\n            height: image.height\n          }));\n        };\n\n        image.onerror = function () {\n          reject('There was an error loading the data URI as an image on the following SVG\\n' + window.atob(uri.slice(26)) + 'Open the following link to see browser\\'s diagnosis\\n' + uri);\n        };\n\n        image.src = uri;\n      });\n    });\n  };\n\n  out$.download = function (name, uri, options) {\n    if (navigator.msSaveOrOpenBlob) navigator.msSaveOrOpenBlob(uriToBlob(uri), name);else {\n      var saveLink = document.createElement('a');\n\n      if ('download' in saveLink) {\n        saveLink.download = name;\n        saveLink.style.display = 'none';\n        document.body.appendChild(saveLink);\n\n        try {\n          var blob = uriToBlob(uri);\n          var url = URL.createObjectURL(blob);\n          saveLink.href = url;\n\n          saveLink.onclick = function () {\n            return requestAnimationFrame(function () {\n              return URL.revokeObjectURL(url);\n            });\n          };\n        } catch (e) {\n          console.error(e);\n          console.warn('Error while getting object URL. Falling back to string URL.');\n          saveLink.href = uri;\n        }\n\n        saveLink.click();\n        document.body.removeChild(saveLink);\n      } else if (options && options.popup) {\n        options.popup.document.title = name;\n        options.popup.location.replace(uri);\n      }\n    }\n  };\n\n  out$.saveSvg = function (el, name, options) {\n    var downloadOpts = downloadOptions(); // don't inline, can't be async\n\n    return requireDomNodePromise(el).then(function (el) {\n      return out$.svgAsDataUri(el, options || {});\n    }).then(function (uri) {\n      return out$.download(name, uri, downloadOpts);\n    });\n  };\n\n  out$.saveSvgAsPng = function (el, name, options) {\n    var downloadOpts = downloadOptions(); // don't inline, can't be async\n\n    return requireDomNodePromise(el).then(function (el) {\n      return out$.svgAsPngUri(el, options || {});\n    }).then(function (uri) {\n      return out$.download(name, uri, downloadOpts);\n    });\n  };\n})();","map":{"version":3,"sources":["C:/Users/chena/QbitesReact/my-app/node_modules/save-svg-as-png/lib/saveSvgAsPng.js"],"names":["out$","exports","define","window","default","xmlNs","xhtmlNs","svgNs","doctype","urlRegex","fontFormats","woff2","woff","otf","ttf","eot","sfnt","svg","isElement","obj","HTMLElement","SVGElement","requireDomNode","el","Error","requireDomNodePromise","Promise","resolve","reject","isExternal","url","lastIndexOf","location","host","getFontMimeTypeFromUrl","fontUrl","formats","Object","keys","filter","extension","indexOf","map","console","error","arrayBufferToBase64","buffer","binary","bytes","Uint8Array","i","byteLength","String","fromCharCode","btoa","getDimension","clone","dim","v","viewBox","baseVal","getAttribute","match","parseInt","getBoundingClientRect","style","getComputedStyle","getPropertyValue","isNaN","parseFloat","getDimensions","width","height","tagName","getBBox","_el$getBBox","x","y","_width","_height","reEncode","data","decodeURIComponent","encodeURIComponent","replace","p1","c","uriToBlob","uri","byteString","atob","split","mimeString","ArrayBuffer","length","intArray","charCodeAt","Blob","type","query","selector","querySelector","parentNode","err","warn","detectCssFont","rule","href","cssText","fullUrl","startsWith","text","format","inlineImages","all","Array","from","querySelectorAll","image","getAttributeNS","Date","valueOf","canvas","document","createElement","img","Image","crossOrigin","src","onerror","onload","getContext","drawImage","setAttributeNS","toDataURL","cachedFonts","inlineFonts","fonts","font","req","XMLHttpRequest","addEventListener","fontInBase64","response","fontUri","e","open","responseType","send","then","fontCss","join","cachedRules","styleSheetRules","styleSheets","sheet","rules","cssRules","inlineCss","options","_ref","selectorRemap","modifyStyle","modifyCss","excludeUnusedCss","generateCss","properties","sel","props","css","detectFonts","fontList","forEach","_ref2","selectorText","push","downloadOptions","navigator","msSaveOrOpenBlob","popup","prepareSvg","done","_ref3","_ref3$left","left","undefined","_ref3$top","top","w","h","_ref3$scale","scale","_ref3$responsive","responsive","_ref3$excludeCss","excludeCss","cloneNode","backgroundColor","_getDimensions","setAttribute","createElementNS","appendChild","removeAttribute","foreignObject","outer","innerHTML","defs","insertBefore","firstChild","svgAsDataUri","_ref4","svgXml","svgAsPngUri","_ref5","_ref5$encoderType","encoderType","_ref5$encoderOptions","encoderOptions","canvg","convertToPng","_ref6","context","pixelRatio","devicePixelRatio","setTransform","png","SecurityError","name","slice","download","saveLink","display","body","blob","URL","createObjectURL","onclick","requestAnimationFrame","revokeObjectURL","click","removeChild","title","saveSvg","downloadOpts","saveSvgAsPng"],"mappings":"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","sourcesContent":["'use strict';\r\n\r\n(function () {\r\n  var out$ = typeof exports != 'undefined' && exports || typeof define != 'undefined' && {} || this || window;\r\n  if (typeof define !== 'undefined') define('save-svg-as-png', [], function () {\r\n    return out$;\r\n  });\r\n  out$.default = out$;\r\n\r\n  var xmlNs = 'http://www.w3.org/2000/xmlns/';\r\n  var xhtmlNs = 'http://www.w3.org/1999/xhtml';\r\n  var svgNs = 'http://www.w3.org/2000/svg';\r\n  var doctype = '<?xml version=\"1.0\" standalone=\"no\"?><!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\" [<!ENTITY nbsp \"&#160;\">]>';\r\n  var urlRegex = /url\\([\"']?(.+?)[\"']?\\)/;\r\n  var fontFormats = {\r\n    woff2: 'font/woff2',\r\n    woff: 'font/woff',\r\n    otf: 'application/x-font-opentype',\r\n    ttf: 'application/x-font-ttf',\r\n    eot: 'application/vnd.ms-fontobject',\r\n    sfnt: 'application/font-sfnt',\r\n    svg: 'image/svg+xml'\r\n  };\r\n\r\n  var isElement = function isElement(obj) {\r\n    return obj instanceof HTMLElement || obj instanceof SVGElement;\r\n  };\r\n  var requireDomNode = function requireDomNode(el) {\r\n    if (!isElement(el)) throw new Error('an HTMLElement or SVGElement is required; got ' + el);\r\n  };\r\n  var requireDomNodePromise = function requireDomNodePromise(el) {\r\n    return new Promise(function (resolve, reject) {\r\n      if (isElement(el)) resolve(el);else reject(new Error('an HTMLElement or SVGElement is required; got ' + el));\r\n    });\r\n  };\r\n  var isExternal = function isExternal(url) {\r\n    return url && url.lastIndexOf('http', 0) === 0 && url.lastIndexOf(window.location.host) === -1;\r\n  };\r\n\r\n  var getFontMimeTypeFromUrl = function getFontMimeTypeFromUrl(fontUrl) {\r\n    var formats = Object.keys(fontFormats).filter(function (extension) {\r\n      return fontUrl.indexOf('.' + extension) > 0;\r\n    }).map(function (extension) {\r\n      return fontFormats[extension];\r\n    });\r\n    if (formats) return formats[0];\r\n    console.error('Unknown font format for ' + fontUrl + '. Fonts may not be working correctly.');\r\n    return 'application/octet-stream';\r\n  };\r\n\r\n  var arrayBufferToBase64 = function arrayBufferToBase64(buffer) {\r\n    var binary = '';\r\n    var bytes = new Uint8Array(buffer);\r\n    for (var i = 0; i < bytes.byteLength; i++) {\r\n      binary += String.fromCharCode(bytes[i]);\r\n    }return window.btoa(binary);\r\n  };\r\n\r\n  var getDimension = function getDimension(el, clone, dim) {\r\n    var v = el.viewBox && el.viewBox.baseVal && el.viewBox.baseVal[dim] || clone.getAttribute(dim) !== null && !clone.getAttribute(dim).match(/%$/) && parseInt(clone.getAttribute(dim)) || el.getBoundingClientRect()[dim] || parseInt(clone.style[dim]) || parseInt(window.getComputedStyle(el).getPropertyValue(dim));\r\n    return typeof v === 'undefined' || v === null || isNaN(parseFloat(v)) ? 0 : v;\r\n  };\r\n\r\n  var getDimensions = function getDimensions(el, clone, width, height) {\r\n    if (el.tagName === 'svg') return {\r\n      width: width || getDimension(el, clone, 'width'),\r\n      height: height || getDimension(el, clone, 'height')\r\n    };else if (el.getBBox) {\r\n      var _el$getBBox = el.getBBox(),\r\n          x = _el$getBBox.x,\r\n          y = _el$getBBox.y,\r\n          _width = _el$getBBox.width,\r\n          _height = _el$getBBox.height;\r\n\r\n      return {\r\n        width: x + _width,\r\n        height: y + _height\r\n      };\r\n    }\r\n  };\r\n\r\n  var reEncode = function reEncode(data) {\r\n    return decodeURIComponent(encodeURIComponent(data).replace(/%([0-9A-F]{2})/g, function (match, p1) {\r\n      var c = String.fromCharCode('0x' + p1);\r\n      return c === '%' ? '%25' : c;\r\n    }));\r\n  };\r\n\r\n  var uriToBlob = function uriToBlob(uri) {\r\n    var byteString = window.atob(uri.split(',')[1]);\r\n    var mimeString = uri.split(',')[0].split(':')[1].split(';')[0];\r\n    var buffer = new ArrayBuffer(byteString.length);\r\n    var intArray = new Uint8Array(buffer);\r\n    for (var i = 0; i < byteString.length; i++) {\r\n      intArray[i] = byteString.charCodeAt(i);\r\n    }\r\n    return new Blob([buffer], { type: mimeString });\r\n  };\r\n\r\n  var query = function query(el, selector) {\r\n    if (!selector) return;\r\n    try {\r\n      return el.querySelector(selector) || el.parentNode && el.parentNode.querySelector(selector);\r\n    } catch (err) {\r\n      console.warn('Invalid CSS selector \"' + selector + '\"', err);\r\n    }\r\n  };\r\n\r\n  var detectCssFont = function detectCssFont(rule, href) {\r\n    // Match CSS font-face rules to external links.\r\n    // @font-face {\r\n    //   src: local('Abel'), url(https://fonts.gstatic.com/s/abel/v6/UzN-iejR1VoXU2Oc-7LsbvesZW2xOQ-xsNqO47m55DA.woff2);\r\n    // }\r\n    var match = rule.cssText.match(urlRegex);\r\n    var url = match && match[1] || '';\r\n    if (!url || url.match(/^data:/) || url === 'about:blank') return;\r\n    var fullUrl = url.startsWith('../') ? href + '/../' + url : url.startsWith('./') ? href + '/.' + url : url;\r\n    return {\r\n      text: rule.cssText,\r\n      format: getFontMimeTypeFromUrl(fullUrl),\r\n      url: fullUrl\r\n    };\r\n  };\r\n\r\n  var inlineImages = function inlineImages(el) {\r\n    return Promise.all(Array.from(el.querySelectorAll('image')).map(function (image) {\r\n      var href = image.getAttributeNS('http://www.w3.org/1999/xlink', 'href') || image.getAttribute('href');\r\n      if (!href) return Promise.resolve(null);\r\n      if (isExternal(href)) {\r\n        href += (href.indexOf('?') === -1 ? '?' : '&') + 't=' + new Date().valueOf();\r\n      }\r\n      return new Promise(function (resolve, reject) {\r\n        var canvas = document.createElement('canvas');\r\n        var img = new Image();\r\n        img.crossOrigin = 'anonymous';\r\n        img.src = href;\r\n        img.onerror = function () {\r\n          return reject(new Error('Could not load ' + href));\r\n        };\r\n        img.onload = function () {\r\n          canvas.width = img.width;\r\n          canvas.height = img.height;\r\n          canvas.getContext('2d').drawImage(img, 0, 0);\r\n          image.setAttributeNS('http://www.w3.org/1999/xlink', 'href', canvas.toDataURL('image/png'));\r\n          resolve(true);\r\n        };\r\n      });\r\n    }));\r\n  };\r\n\r\n  var cachedFonts = {};\r\n  var inlineFonts = function inlineFonts(fonts) {\r\n    return Promise.all(fonts.map(function (font) {\r\n      return new Promise(function (resolve, reject) {\r\n        if (cachedFonts[font.url]) return resolve(cachedFonts[font.url]);\r\n\r\n        var req = new XMLHttpRequest();\r\n        req.addEventListener('load', function () {\r\n          // TODO: it may also be worth it to wait until fonts are fully loaded before\r\n          // attempting to rasterize them. (e.g. use https://developer.mozilla.org/en-US/docs/Web/API/FontFaceSet)\r\n          var fontInBase64 = arrayBufferToBase64(req.response);\r\n          var fontUri = font.text.replace(urlRegex, 'url(\"data:' + font.format + ';base64,' + fontInBase64 + '\")') + '\\n';\r\n          cachedFonts[font.url] = fontUri;\r\n          resolve(fontUri);\r\n        });\r\n        req.addEventListener('error', function (e) {\r\n          console.warn('Failed to load font from: ' + font.url, e);\r\n          cachedFonts[font.url] = null;\r\n          resolve(null);\r\n        });\r\n        req.addEventListener('abort', function (e) {\r\n          console.warn('Aborted loading font from: ' + font.url, e);\r\n          resolve(null);\r\n        });\r\n        req.open('GET', font.url);\r\n        req.responseType = 'arraybuffer';\r\n        req.send();\r\n      });\r\n    })).then(function (fontCss) {\r\n      return fontCss.filter(function (x) {\r\n        return x;\r\n      }).join('');\r\n    });\r\n  };\r\n\r\n  var cachedRules = null;\r\n  var styleSheetRules = function styleSheetRules() {\r\n    if (cachedRules) return cachedRules;\r\n    return cachedRules = Array.from(document.styleSheets).map(function (sheet) {\r\n      try {\r\n        return { rules: sheet.cssRules, href: sheet.href };\r\n      } catch (e) {\r\n        console.warn('Stylesheet could not be loaded: ' + sheet.href, e);\r\n        return {};\r\n      }\r\n    });\r\n  };\r\n\r\n  var inlineCss = function inlineCss(el, options) {\r\n    var _ref = options || {},\r\n        selectorRemap = _ref.selectorRemap,\r\n        modifyStyle = _ref.modifyStyle,\r\n        modifyCss = _ref.modifyCss,\r\n        fonts = _ref.fonts,\r\n        excludeUnusedCss = _ref.excludeUnusedCss;\r\n\r\n    var generateCss = modifyCss || function (selector, properties) {\r\n      var sel = selectorRemap ? selectorRemap(selector) : selector;\r\n      var props = modifyStyle ? modifyStyle(properties) : properties;\r\n      return sel + '{' + props + '}\\n';\r\n    };\r\n    var css = [];\r\n    var detectFonts = typeof fonts === 'undefined';\r\n    var fontList = fonts || [];\r\n    styleSheetRules().forEach(function (_ref2) {\r\n      var rules = _ref2.rules,\r\n          href = _ref2.href;\r\n\r\n      if (!rules) return;\r\n      Array.from(rules).forEach(function (rule) {\r\n        if (typeof rule.style != 'undefined') {\r\n          if (query(el, rule.selectorText)) css.push(generateCss(rule.selectorText, rule.style.cssText));else if (detectFonts && rule.cssText.match(/^@font-face/)) {\r\n            var font = detectCssFont(rule, href);\r\n            if (font) fontList.push(font);\r\n          } else if (!excludeUnusedCss) {\r\n            css.push(rule.cssText);\r\n          }\r\n        }\r\n      });\r\n    });\r\n\r\n    return inlineFonts(fontList).then(function (fontCss) {\r\n      return css.join('\\n') + fontCss;\r\n    });\r\n  };\r\n\r\n  var downloadOptions = function downloadOptions() {\r\n    if (!navigator.msSaveOrOpenBlob && !('download' in document.createElement('a'))) {\r\n      return { popup: window.open() };\r\n    }\r\n  };\r\n\r\n  out$.prepareSvg = function (el, options, done) {\r\n    requireDomNode(el);\r\n\r\n    var _ref3 = options || {},\r\n        _ref3$left = _ref3.left,\r\n        left = _ref3$left === undefined ? 0 : _ref3$left,\r\n        _ref3$top = _ref3.top,\r\n        top = _ref3$top === undefined ? 0 : _ref3$top,\r\n        w = _ref3.width,\r\n        h = _ref3.height,\r\n        _ref3$scale = _ref3.scale,\r\n        scale = _ref3$scale === undefined ? 1 : _ref3$scale,\r\n        _ref3$responsive = _ref3.responsive,\r\n        responsive = _ref3$responsive === undefined ? false : _ref3$responsive,\r\n        _ref3$excludeCss = _ref3.excludeCss,\r\n        excludeCss = _ref3$excludeCss === undefined ? false : _ref3$excludeCss;\r\n\r\n    return inlineImages(el).then(function () {\r\n      var clone = el.cloneNode(true);\r\n      clone.style.backgroundColor = (options || {}).backgroundColor || el.style.backgroundColor;\r\n\r\n      var _getDimensions = getDimensions(el, clone, w, h),\r\n          width = _getDimensions.width,\r\n          height = _getDimensions.height;\r\n\r\n      if (el.tagName !== 'svg') {\r\n        if (el.getBBox) {\r\n          if (clone.getAttribute('transform') != null) {\r\n            clone.setAttribute('transform', clone.getAttribute('transform').replace(/translate\\(.*?\\)/, ''));\r\n          }\r\n          var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n          svg.appendChild(clone);\r\n          clone = svg;\r\n        } else {\r\n          console.error('Attempted to render non-SVG element', el);\r\n          return;\r\n        }\r\n      }\r\n\r\n      clone.setAttribute('version', '1.1');\r\n      clone.setAttribute('viewBox', [left, top, width, height].join(' '));\r\n      if (!clone.getAttribute('xmlns')) clone.setAttributeNS(xmlNs, 'xmlns', svgNs);\r\n      if (!clone.getAttribute('xmlns:xlink')) clone.setAttributeNS(xmlNs, 'xmlns:xlink', 'http://www.w3.org/1999/xlink');\r\n\r\n      if (responsive) {\r\n        clone.removeAttribute('width');\r\n        clone.removeAttribute('height');\r\n        clone.setAttribute('preserveAspectRatio', 'xMinYMin meet');\r\n      } else {\r\n        clone.setAttribute('width', width * scale);\r\n        clone.setAttribute('height', height * scale);\r\n      }\r\n\r\n      Array.from(clone.querySelectorAll('foreignObject > *')).forEach(function (foreignObject) {\r\n        foreignObject.setAttributeNS(xmlNs, 'xmlns', foreignObject.tagName === 'svg' ? svgNs : xhtmlNs);\r\n      });\r\n\r\n      if (excludeCss) {\r\n        var outer = document.createElement('div');\r\n        outer.appendChild(clone);\r\n        var src = outer.innerHTML;\r\n        if (typeof done === 'function') done(src, width, height);else return { src: src, width: width, height: height };\r\n      } else {\r\n        return inlineCss(el, options).then(function (css) {\r\n          var style = document.createElement('style');\r\n          style.setAttribute('type', 'text/css');\r\n          style.innerHTML = '<![CDATA[\\n' + css + '\\n]]>';\r\n\r\n          var defs = document.createElement('defs');\r\n          defs.appendChild(style);\r\n          clone.insertBefore(defs, clone.firstChild);\r\n\r\n          var outer = document.createElement('div');\r\n          outer.appendChild(clone);\r\n          var src = outer.innerHTML.replace(/NS\\d+:href/gi, 'xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href');\r\n\r\n          if (typeof done === 'function') done(src, width, height);else return { src: src, width: width, height: height };\r\n        });\r\n      }\r\n    });\r\n  };\r\n\r\n  out$.svgAsDataUri = function (el, options, done) {\r\n    requireDomNode(el);\r\n    return out$.prepareSvg(el, options).then(function (_ref4) {\r\n      var src = _ref4.src,\r\n          width = _ref4.width,\r\n          height = _ref4.height;\r\n\r\n      var svgXml = 'data:image/svg+xml;base64,' + window.btoa(reEncode(doctype + src));\r\n      if (typeof done === 'function') {\r\n        done(svgXml, width, height);\r\n      }\r\n      return svgXml;\r\n    });\r\n  };\r\n\r\n  out$.svgAsPngUri = function (el, options, done) {\r\n    requireDomNode(el);\r\n\r\n    var _ref5 = options || {},\r\n        _ref5$encoderType = _ref5.encoderType,\r\n        encoderType = _ref5$encoderType === undefined ? 'image/png' : _ref5$encoderType,\r\n        _ref5$encoderOptions = _ref5.encoderOptions,\r\n        encoderOptions = _ref5$encoderOptions === undefined ? 0.8 : _ref5$encoderOptions,\r\n        canvg = _ref5.canvg;\r\n\r\n    var convertToPng = function convertToPng(_ref6) {\r\n      var src = _ref6.src,\r\n          width = _ref6.width,\r\n          height = _ref6.height;\r\n\r\n      var canvas = document.createElement('canvas');\r\n      var context = canvas.getContext('2d');\r\n      var pixelRatio = window.devicePixelRatio || 1;\r\n\r\n      canvas.width = width * pixelRatio;\r\n      canvas.height = height * pixelRatio;\r\n      canvas.style.width = canvas.width + 'px';\r\n      canvas.style.height = canvas.height + 'px';\r\n      context.setTransform(pixelRatio, 0, 0, pixelRatio, 0, 0);\r\n\r\n      if (canvg) canvg(canvas, src);else context.drawImage(src, 0, 0);\r\n\r\n      var png = void 0;\r\n      try {\r\n        png = canvas.toDataURL(encoderType, encoderOptions);\r\n      } catch (e) {\r\n        if (typeof SecurityError !== 'undefined' && e instanceof SecurityError || e.name === 'SecurityError') {\r\n          console.error('Rendered SVG images cannot be downloaded in this browser.');\r\n          return;\r\n        } else throw e;\r\n      }\r\n      if (typeof done === 'function') done(png, canvas.width, canvas.height);\r\n      return Promise.resolve(png);\r\n    };\r\n\r\n    if (canvg) return out$.prepareSvg(el, options).then(convertToPng);else return out$.svgAsDataUri(el, options).then(function (uri) {\r\n      return new Promise(function (resolve, reject) {\r\n        var image = new Image();\r\n        image.onload = function () {\r\n          return resolve(convertToPng({\r\n            src: image,\r\n            width: image.width,\r\n            height: image.height\r\n          }));\r\n        };\r\n        image.onerror = function () {\r\n          reject('There was an error loading the data URI as an image on the following SVG\\n' + window.atob(uri.slice(26)) + 'Open the following link to see browser\\'s diagnosis\\n' + uri);\r\n        };\r\n        image.src = uri;\r\n      });\r\n    });\r\n  };\r\n\r\n  out$.download = function (name, uri, options) {\r\n    if (navigator.msSaveOrOpenBlob) navigator.msSaveOrOpenBlob(uriToBlob(uri), name);else {\r\n      var saveLink = document.createElement('a');\r\n      if ('download' in saveLink) {\r\n        saveLink.download = name;\r\n        saveLink.style.display = 'none';\r\n        document.body.appendChild(saveLink);\r\n        try {\r\n          var blob = uriToBlob(uri);\r\n          var url = URL.createObjectURL(blob);\r\n          saveLink.href = url;\r\n          saveLink.onclick = function () {\r\n            return requestAnimationFrame(function () {\r\n              return URL.revokeObjectURL(url);\r\n            });\r\n          };\r\n        } catch (e) {\r\n          console.error(e);\r\n          console.warn('Error while getting object URL. Falling back to string URL.');\r\n          saveLink.href = uri;\r\n        }\r\n        saveLink.click();\r\n        document.body.removeChild(saveLink);\r\n      } else if (options && options.popup) {\r\n        options.popup.document.title = name;\r\n        options.popup.location.replace(uri);\r\n      }\r\n    }\r\n  };\r\n\r\n  out$.saveSvg = function (el, name, options) {\r\n    var downloadOpts = downloadOptions(); // don't inline, can't be async\r\n    return requireDomNodePromise(el).then(function (el) {\r\n      return out$.svgAsDataUri(el, options || {});\r\n    }).then(function (uri) {\r\n      return out$.download(name, uri, downloadOpts);\r\n    });\r\n  };\r\n\r\n  out$.saveSvgAsPng = function (el, name, options) {\r\n    var downloadOpts = downloadOptions(); // don't inline, can't be async\r\n    return requireDomNodePromise(el).then(function (el) {\r\n      return out$.svgAsPngUri(el, options || {});\r\n    }).then(function (uri) {\r\n      return out$.download(name, uri, downloadOpts);\r\n    });\r\n  };\r\n})();"]},"metadata":{},"sourceType":"script"}
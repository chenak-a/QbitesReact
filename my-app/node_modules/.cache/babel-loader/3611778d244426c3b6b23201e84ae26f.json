{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nexports.edge1Provider = edge1Provider;\nexports.edge2Provider = edge2Provider;\n\nvar _react = require(\"react\");\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _propTypes = require(\"prop-types\");\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _d3Array = require(\"d3-array\");\n\nvar _d3Path = require(\"d3-path\");\n\nvar _GenericChartComponent = require(\"../../GenericChartComponent\");\n\nvar _GenericChartComponent2 = _interopRequireDefault(_GenericChartComponent);\n\nvar _GenericComponent = require(\"../../GenericComponent\");\n\nvar _StraightLine = require(\"./StraightLine\");\n\nvar _utils = require(\"../../utils\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n}\n\nvar LinearRegressionChannelWithArea = function (_Component) {\n  _inherits(LinearRegressionChannelWithArea, _Component);\n\n  function LinearRegressionChannelWithArea(props) {\n    _classCallCheck(this, LinearRegressionChannelWithArea);\n\n    var _this = _possibleConstructorReturn(this, (LinearRegressionChannelWithArea.__proto__ || Object.getPrototypeOf(LinearRegressionChannelWithArea)).call(this, props));\n\n    _this.renderSVG = _this.renderSVG.bind(_this);\n    _this.drawOnCanvas = _this.drawOnCanvas.bind(_this);\n    _this.isHover = _this.isHover.bind(_this);\n    return _this;\n  }\n\n  _createClass(LinearRegressionChannelWithArea, [{\n    key: \"isHover\",\n    value: function isHover(moreProps) {\n      var _props = this.props,\n          tolerance = _props.tolerance,\n          onHover = _props.onHover;\n\n      if ((0, _utils.isDefined)(onHover)) {\n        var mouseXY = moreProps.mouseXY;\n\n        var _helper = helper(this.props, moreProps),\n            x1 = _helper.x1,\n            y1 = _helper.y1,\n            x2 = _helper.x2,\n            y2 = _helper.y2,\n            dy = _helper.dy;\n\n        var yDiffs = [-dy, 0, dy];\n        var hovering = yDiffs.reduce(function (result, diff) {\n          return result || (0, _StraightLine.isHovering2)([x1, y1 + diff], [x2, y2 + diff], mouseXY, tolerance);\n        }, false);\n        return hovering;\n      }\n\n      return false;\n    }\n  }, {\n    key: \"drawOnCanvas\",\n    value: function drawOnCanvas(ctx, moreProps) {\n      var _props2 = this.props,\n          stroke = _props2.stroke,\n          strokeWidth = _props2.strokeWidth,\n          fillOpacity = _props2.fillOpacity,\n          strokeOpacity = _props2.strokeOpacity,\n          fill = _props2.fill;\n\n      var _helper2 = helper(this.props, moreProps),\n          x1 = _helper2.x1,\n          y1 = _helper2.y1,\n          x2 = _helper2.x2,\n          y2 = _helper2.y2,\n          dy = _helper2.dy;\n\n      ctx.lineWidth = strokeWidth;\n      ctx.strokeStyle = (0, _utils.hexToRGBA)(stroke, strokeOpacity);\n      ctx.fillStyle = (0, _utils.hexToRGBA)(fill, fillOpacity);\n      ctx.beginPath();\n      ctx.moveTo(x1, y1 - dy);\n      ctx.lineTo(x2, y2 - dy);\n      ctx.stroke();\n      ctx.beginPath();\n      ctx.moveTo(x2, y2 + dy);\n      ctx.lineTo(x1, y1 + dy);\n      ctx.stroke();\n      ctx.beginPath();\n      ctx.moveTo(x1, y1 - dy);\n      ctx.lineTo(x2, y2 - dy);\n      ctx.lineTo(x2, y2 + dy);\n      ctx.lineTo(x1, y1 + dy);\n      ctx.closePath();\n      ctx.fill();\n      ctx.beginPath();\n      ctx.moveTo(x2, y2);\n      ctx.lineTo(x1, y1);\n      ctx.stroke();\n    }\n  }, {\n    key: \"renderSVG\",\n    value: function renderSVG(moreProps) {\n      var _props3 = this.props,\n          stroke = _props3.stroke,\n          strokeWidth = _props3.strokeWidth,\n          fillOpacity = _props3.fillOpacity,\n          strokeOpacity = _props3.strokeOpacity,\n          fill = _props3.fill;\n\n      var _helper3 = helper(this.props, moreProps),\n          x1 = _helper3.x1,\n          y1 = _helper3.y1,\n          x2 = _helper3.x2,\n          y2 = _helper3.y2,\n          dy = _helper3.dy;\n\n      var line = {\n        strokeWidth: strokeWidth,\n        stroke: stroke,\n        strokeOpacity: strokeOpacity\n      };\n      var ctx = (0, _d3Path.path)();\n      ctx.moveTo(x1, y1 - dy);\n      ctx.lineTo(x2, y2 - dy);\n      ctx.lineTo(x2, y2 + dy);\n      ctx.lineTo(x1, y1 + dy);\n      ctx.closePath();\n      return _react2.default.createElement(\"g\", null, _react2.default.createElement(\"line\", _extends({}, line, {\n        x1: x1,\n        y1: y1 - dy,\n        x2: x2,\n        y2: y2 - dy\n      })), _react2.default.createElement(\"line\", _extends({}, line, {\n        x1: x1,\n        y1: y1 + dy,\n        x2: x2,\n        y2: y2 + dy\n      })), _react2.default.createElement(\"path\", {\n        d: ctx.toString(),\n        fill: fill,\n        fillOpacity: fillOpacity\n      }), _react2.default.createElement(\"line\", _extends({}, line, {\n        x1: x1,\n        y1: y1,\n        x2: x2,\n        y2: y2\n      })));\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _props4 = this.props,\n          selected = _props4.selected,\n          interactiveCursorClass = _props4.interactiveCursorClass;\n      var _props5 = this.props,\n          onHover = _props5.onHover,\n          onUnHover = _props5.onUnHover;\n      return _react2.default.createElement(_GenericChartComponent2.default, {\n        isHover: this.isHover,\n        svgDraw: this.renderSVG,\n        canvasToDraw: _GenericComponent.getMouseCanvas,\n        canvasDraw: this.drawOnCanvas,\n        interactiveCursorClass: interactiveCursorClass,\n        selected: selected,\n        onHover: onHover,\n        onUnHover: onUnHover,\n        drawOn: [\"mousemove\", \"mouseleave\", \"pan\", \"drag\"]\n      });\n    }\n  }]);\n\n  return LinearRegressionChannelWithArea;\n}(_react.Component);\n\nfunction edge1Provider(props) {\n  return function (moreProps) {\n    var _helper4 = helper(props, moreProps),\n        x1 = _helper4.x1,\n        y1 = _helper4.y1;\n\n    return [x1, y1];\n  };\n}\n\nfunction edge2Provider(props) {\n  return function (moreProps) {\n    var _helper5 = helper(props, moreProps),\n        x2 = _helper5.x2,\n        y2 = _helper5.y2;\n\n    return [x2, y2];\n  };\n}\n\nfunction helper(props, moreProps) {\n  var x1Value = props.x1Value,\n      x2Value = props.x2Value,\n      type = props.type;\n  var xScale = moreProps.xScale,\n      yScale = moreProps.chartConfig.yScale,\n      fullData = moreProps.fullData;\n  var xAccessor = moreProps.xAccessor;\n  /*\n  http://www.metastock.com/Customer/Resources/TAAZ/?p=65\n  y = a + bx\n  n = length of array\n  b = (n * sum(x*y) - sum(xs) * sum(ys)) / (n * sum(xSquareds) - (sum(xs) ^ 2))\n  a = (sum of closes)\n  */\n\n  var _getClosestItemIndexe = (0, _utils.getClosestItemIndexes)(fullData, x1Value, xAccessor),\n      left = _getClosestItemIndexe.left;\n\n  var _getClosestItemIndexe2 = (0, _utils.getClosestItemIndexes)(fullData, x2Value, xAccessor),\n      right = _getClosestItemIndexe2.right;\n\n  var startIndex = Math.min(left, right);\n  var endIndex = Math.max(left, right) + 1;\n  var array = fullData.slice(startIndex, endIndex);\n  var xs = array.map(function (d) {\n    return xAccessor(d).valueOf();\n  });\n  var ys = array.map(function (d) {\n    return d.close;\n  });\n  var n = array.length;\n  var combine = (0, _utils.zipper)().combine(function (x, y) {\n    return x * y;\n  });\n  var xys = combine(xs, ys);\n  var xSquareds = xs.map(function (x) {\n    return Math.pow(x, 2);\n  });\n  var b = (n * (0, _d3Array.sum)(xys) - (0, _d3Array.sum)(xs) * (0, _d3Array.sum)(ys)) / (n * (0, _d3Array.sum)(xSquareds) - Math.pow((0, _d3Array.sum)(xs), 2));\n  var a = ((0, _d3Array.sum)(ys) - b * (0, _d3Array.sum)(xs)) / n;\n  var newy1 = a + b * x1Value;\n  var newy2 = a + b * x2Value;\n  var x1 = xScale(x1Value);\n  var y1 = yScale(newy1);\n  var x2 = xScale(x2Value);\n  var y2 = yScale(newy2);\n  var stdDev = type === \"SD\" ? (0, _d3Array.deviation)(array, function (d) {\n    return d.close;\n  }) : 0;\n  var dy = yScale(newy1 - stdDev) - y1;\n  return {\n    x1: x1,\n    y1: y1,\n    x2: x2,\n    y2: y2,\n    dy: dy\n  };\n}\n\nLinearRegressionChannelWithArea.propTypes = {\n  x1Value: _propTypes2.default.any.isRequired,\n  x2Value: _propTypes2.default.any.isRequired,\n  type: _propTypes2.default.oneOf([\"SD\", // standard deviation channel\n  \"Raff\"] // Raff Regression Channel\n  ).isRequired,\n  interactiveCursorClass: _propTypes2.default.string,\n  stroke: _propTypes2.default.string.isRequired,\n  strokeWidth: _propTypes2.default.number.isRequired,\n  fill: _propTypes2.default.string.isRequired,\n  fillOpacity: _propTypes2.default.number.isRequired,\n  strokeOpacity: _propTypes2.default.number.isRequired,\n  onDragStart: _propTypes2.default.func.isRequired,\n  onDrag: _propTypes2.default.func.isRequired,\n  onDragComplete: _propTypes2.default.func.isRequired,\n  onHover: _propTypes2.default.func,\n  onUnHover: _propTypes2.default.func,\n  defaultClassName: _propTypes2.default.string,\n  tolerance: _propTypes2.default.number.isRequired,\n  selected: _propTypes2.default.bool.isRequired\n};\nLinearRegressionChannelWithArea.defaultProps = {\n  onDragStart: _utils.noop,\n  onDrag: _utils.noop,\n  onDragComplete: _utils.noop,\n  type: \"SD\",\n  // standard dev\n  strokeWidth: 1,\n  tolerance: 4,\n  selected: false\n};\nexports.default = LinearRegressionChannelWithArea;","map":{"version":3,"mappings":"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","names":["edge1Provider","edge2Provider","LinearRegressionChannelWithArea","props","_classCallCheck","_this","renderSVG","bind","drawOnCanvas","isHover","moreProps","tolerance","onHover","mouseXY","helper","x1","y1","x2","y2","dy","yDiffs","hovering","reduce","result","diff","ctx","stroke","strokeWidth","fillOpacity","strokeOpacity","fill","lineWidth","strokeStyle","fillStyle","beginPath","moveTo","lineTo","closePath","line","_react2","d","toString","selected","interactiveCursorClass","onUnHover","svgDraw","canvasToDraw","canvasDraw","drawOn","x1Value","x2Value","type","xScale","yScale","chartConfig","fullData","xAccessor","left","right","startIndex","Math","min","endIndex","max","array","slice","xs","map","valueOf","ys","close","n","length","combine","x","y","xys","xSquareds","pow","b","a","newy1","newy2","stdDev","propTypes","_propTypes2","any","isRequired","oneOf","string","number","onDragStart","func","onDrag","onDragComplete","defaultClassName","bool","defaultProps"],"sources":["../../../../src/lib/interactive/components/LinearRegressionChannelWithArea.js"],"sourcesContent":["import React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { sum, deviation } from \"d3-array\";\nimport { path as d3Path } from \"d3-path\";\n\nimport GenericChartComponent from \"../../GenericChartComponent\";\nimport { getMouseCanvas } from \"../../GenericComponent\";\nimport { isHovering2 } from \"./StraightLine\";\n\nimport { isDefined, getClosestItemIndexes, noop, zipper, hexToRGBA } from \"../../utils\";\n\nclass LinearRegressionChannelWithArea extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.renderSVG = this.renderSVG.bind(this);\n\t\tthis.drawOnCanvas = this.drawOnCanvas.bind(this);\n\t\tthis.isHover = this.isHover.bind(this);\n\t}\n\tisHover(moreProps) {\n\t\tconst { tolerance, onHover } = this.props;\n\n\t\tif (isDefined(onHover)) {\n\t\t\tconst { mouseXY } = moreProps;\n\n\t\t\tconst { x1, y1, x2, y2, dy } = helper(this.props, moreProps);\n\t\t\tconst yDiffs = [-dy, 0, dy];\n\n\t\t\tconst hovering = yDiffs.reduce((result, diff) => result || isHovering2(\n\t\t\t\t[x1, y1 + diff], [x2, y2 + diff], mouseXY, tolerance\n\t\t\t), false);\n\t\t\treturn hovering;\n\t\t}\n\t\treturn false;\n\t}\n\tdrawOnCanvas(ctx, moreProps) {\n\t\tconst { stroke, strokeWidth, fillOpacity, strokeOpacity, fill } = this.props;\n\t\tconst { x1, y1, x2, y2, dy } = helper(this.props, moreProps);\n\n\t\tctx.lineWidth = strokeWidth;\n\t\tctx.strokeStyle = hexToRGBA(stroke, strokeOpacity);\n\t\tctx.fillStyle = hexToRGBA(fill, fillOpacity);\n\n\t\tctx.beginPath();\n\t\tctx.moveTo(x1, y1 - dy);\n\t\tctx.lineTo(x2, y2 - dy);\n\t\tctx.stroke();\n\n\t\tctx.beginPath();\n\t\tctx.moveTo(x2, y2 + dy);\n\t\tctx.lineTo(x1, y1 + dy);\n\t\tctx.stroke();\n\n\t\tctx.beginPath();\n\t\tctx.moveTo(x1, y1 - dy);\n\t\tctx.lineTo(x2, y2 - dy);\n\t\tctx.lineTo(x2, y2 + dy);\n\t\tctx.lineTo(x1, y1 + dy);\n\t\tctx.closePath();\n\t\tctx.fill();\n\n\t\tctx.beginPath();\n\t\tctx.moveTo(x2, y2);\n\t\tctx.lineTo(x1, y1);\n\t\tctx.stroke();\n\t}\n\trenderSVG(moreProps) {\n\t\tconst { stroke, strokeWidth, fillOpacity, strokeOpacity, fill } = this.props;\n\t\tconst { x1, y1, x2, y2, dy } = helper(this.props, moreProps);\n\t\tconst line = {\n\t\t\tstrokeWidth,\n\t\t\tstroke,\n\t\t\tstrokeOpacity,\n\t\t};\n\t\tconst ctx = d3Path();\n\t\tctx.moveTo(x1, y1 - dy);\n\t\tctx.lineTo(x2, y2 - dy);\n\t\tctx.lineTo(x2, y2 + dy);\n\t\tctx.lineTo(x1, y1 + dy);\n\t\tctx.closePath();\n\t\treturn (\n\t\t\t<g>\n\t\t\t\t<line\n\t\t\t\t\t{...line}\n\t\t\t\t\tx1={x1}\n\t\t\t\t\ty1={y1 - dy}\n\t\t\t\t\tx2={x2}\n\t\t\t\t\ty2={y2 - dy}\n\t\t\t\t/>\n\t\t\t\t<line\n\t\t\t\t\t{...line}\n\t\t\t\t\tx1={x1}\n\t\t\t\t\ty1={y1 + dy}\n\t\t\t\t\tx2={x2}\n\t\t\t\t\ty2={y2 + dy}\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\td={ctx.toString()}\n\t\t\t\t\tfill={fill}\n\t\t\t\t\tfillOpacity={fillOpacity}\n\t\t\t\t/>\n\t\t\t\t<line\n\t\t\t\t\t{...line}\n\t\t\t\t\tx1={x1}\n\t\t\t\t\ty1={y1}\n\t\t\t\t\tx2={x2}\n\t\t\t\t\ty2={y2}\n\t\t\t\t/>\n\t\t\t</g>\n\t\t);\n\t}\n\trender() {\n\t\tconst { selected, interactiveCursorClass } = this.props;\n\t\tconst { onHover, onUnHover } = this.props;\n\n\t\treturn <GenericChartComponent\n\t\t\tisHover={this.isHover}\n\n\t\t\tsvgDraw={this.renderSVG}\n\t\t\tcanvasToDraw={getMouseCanvas}\n\t\t\tcanvasDraw={this.drawOnCanvas}\n\n\t\t\tinteractiveCursorClass={interactiveCursorClass}\n\t\t\tselected={selected}\n\n\t\t\tonHover={onHover}\n\t\t\tonUnHover={onUnHover}\n\n\t\t\tdrawOn={[\"mousemove\", \"mouseleave\", \"pan\", \"drag\"]}\n\t\t/>;\n\t}\n}\n\nexport function edge1Provider(props) {\n\treturn function(moreProps) {\n\t\tconst { x1, y1 } = helper(props, moreProps);\n\t\treturn [x1, y1];\n\t};\n}\n\nexport function edge2Provider(props) {\n\treturn function(moreProps) {\n\t\tconst { x2, y2 } = helper(props, moreProps);\n\t\treturn [x2, y2];\n\t};\n}\n\n\nfunction helper(props, moreProps) {\n\tconst { x1Value, x2Value, type } = props;\n\n\tconst { xScale, chartConfig: { yScale }, fullData } = moreProps;\n\tconst { xAccessor } = moreProps;\n\n\t/*\n\thttp://www.metastock.com/Customer/Resources/TAAZ/?p=65\n\ty = a + bx\n\tn = length of array\n\tb = (n * sum(x*y) - sum(xs) * sum(ys)) / (n * sum(xSquareds) - (sum(xs) ^ 2))\n\ta = (sum of closes)\n\t*/\n\n\tconst { left } = getClosestItemIndexes(fullData, x1Value, xAccessor);\n\tconst { right } = getClosestItemIndexes(fullData, x2Value, xAccessor);\n\n\tconst startIndex = Math.min(left, right);\n\tconst endIndex = Math.max(left, right) + 1;\n\n\tconst array = fullData.slice(startIndex, endIndex);\n\n\tconst xs = array.map(d => xAccessor(d).valueOf());\n\tconst ys = array.map(d => d.close);\n\tconst n = array.length;\n\n\tconst combine = zipper()\n\t\t.combine((x, y) => x * y);\n\n\tconst xys = combine(xs, ys);\n\tconst xSquareds = xs.map(x => Math.pow(x, 2));\n\n\tconst b = (n * sum(xys) - sum(xs) * sum(ys)) / (n * sum(xSquareds) - Math.pow(sum(xs), 2));\n\tconst a = (sum(ys) - b * sum(xs)) / n;\n\n\tconst newy1 = a + b * x1Value;\n\tconst newy2 = a + b * x2Value;\n\n\tconst x1 = xScale(x1Value);\n\tconst y1 = yScale(newy1);\n\tconst x2 = xScale(x2Value);\n\tconst y2 = yScale(newy2);\n\n\tconst stdDev = type === \"SD\"\n\t\t? deviation(array, d => d.close)\n\t\t: 0;\n\n\tconst dy = yScale(newy1 - stdDev) - y1;\n\n\treturn {\n\t\tx1, y1, x2, y2, dy\n\t};\n}\n\nLinearRegressionChannelWithArea.propTypes = {\n\tx1Value: PropTypes.any.isRequired,\n\tx2Value: PropTypes.any.isRequired,\n\n\ttype: PropTypes.oneOf([\n\t\t\"SD\", // standard deviation channel\n\t\t\"Raff\", // Raff Regression Channel\n\t]).isRequired,\n\n\tinteractiveCursorClass: PropTypes.string,\n\tstroke: PropTypes.string.isRequired,\n\tstrokeWidth: PropTypes.number.isRequired,\n\tfill: PropTypes.string.isRequired,\n\tfillOpacity: PropTypes.number.isRequired,\n\tstrokeOpacity: PropTypes.number.isRequired,\n\n\tonDragStart: PropTypes.func.isRequired,\n\tonDrag: PropTypes.func.isRequired,\n\tonDragComplete: PropTypes.func.isRequired,\n\n\tonHover: PropTypes.func,\n\tonUnHover: PropTypes.func,\n\n\tdefaultClassName: PropTypes.string,\n\n\ttolerance: PropTypes.number.isRequired,\n\tselected: PropTypes.bool.isRequired,\n};\n\nLinearRegressionChannelWithArea.defaultProps = {\n\tonDragStart: noop,\n\tonDrag: noop,\n\tonDragComplete: noop,\n\n\ttype: \"SD\", // standard dev\n\n\tstrokeWidth: 1,\n\ttolerance: 4,\n\tselected: false,\n};\n\nexport default LinearRegressionChannelWithArea;"]},"metadata":{},"sourceType":"script"}